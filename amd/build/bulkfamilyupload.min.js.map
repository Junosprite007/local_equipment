{"version":3,"file":"bulkfamilyupload.min.js","sources":["../src/bulkfamilyupload.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for bulk family upload functionality.\n *\n * @module     local_equipment/bulkfamilyupload\n * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport { get_string as getString } from 'core/str';\nimport Log from 'core/log';\n\n/**\n * Initialize the module.\n */\nexport const init = () => {\n    // Core form elements.\n    const $textarea = $('#id_familiesinputdata');\n    const $preprocessDiv = $('#id_familypreprocessdisplay');\n    const $preprocessButton = $('.preprocessbutton');\n    const $shownexterrorContainer = $('.shownexterror-container');\n    const $noerrorsfoundContainer = $('.noerrorsfound-container');\n    const $shownexterrorButton = $shownexterrorContainer.find('button');\n    const $noerrorsfoundButton = $noerrorsfoundContainer.find('button');\n    const $submitButton = $('#id_submitbutton');\n    const $partnershipData = $('#id_partnershipdata');\n    const $courseData = $('#id_coursesthisyear');\n    const $familiesDataInput = $('#id_familiesdata');\n\n    // Parse initial data.\n    const partnershipDataValue = JSON.parse(\n        $partnershipData.attr('data-partnerships')\n    );\n    const courseDataValue = JSON.parse(\n        $courseData.attr('data-coursesthisyear')\n    );\n\n    // Error navigation state.\n    let currentErrorIndex = -1;\n\n    /**\n     * Process the current data and update UI.\n     */\n    const processCurrentData = async () => {\n        try {\n            const data = {\n                input: cleanInputText($textarea.val()),\n                partnerships: partnershipDataValue,\n                courses: courseDataValue,\n            };\n\n            const families = await validateFamilyData(data);\n            Log.debug('families: ');\n            Log.debug(families);\n            $familiesDataInput.val(JSON.stringify(families.data));\n\n            $preprocessDiv.html(families.html);\n            $preprocessDiv.css('height', $textarea.outerHeight() + 'px');\n\n            const hasErrors = families.html.includes('alert-danger');\n\n            // Update form controls based on error state\n            $shownexterrorButton.prop('hidden', !hasErrors);\n            $shownexterrorButton.prop('disabled', !hasErrors);\n            $noerrorsfoundButton.prop('hidden', hasErrors);\n            $submitButton.prop('disabled', hasErrors);\n            $shownexterrorButton.prop({\n                disabled: !hasErrors,\n                hidden: !hasErrors,\n            });\n\n            // Automatically scroll to first error\n            if (hasErrors && currentErrorIndex === -1) {\n                currentErrorIndex = 0;\n                scrollToError(currentErrorIndex);\n            }\n        } catch (error) {\n            Log.error('Error in preprocessing:', error);\n            $submitButton.prop('disabled', true);\n\n            const errorMessage = await getString(\n                'errorvalidatingfamilydata',\n                'local_equipment'\n            );\n\n            $preprocessDiv.html(\n                `<div class=\"alert alert-danger\">${errorMessage}</div>`\n            );\n        }\n    };\n\n    // Set initial height and handlers\n    $preprocessDiv.css('height', $textarea.outerHeight() + 'px');\n\n    $textarea.on('input', () => {\n        $submitButton.prop('disabled', true);\n    });\n\n    // Function to clean up input text\n    const cleanInputText = (text) => {\n        if (!text || typeof text !== 'string') {\n            return '';\n        }\n        return text.replace(/^\\s+|\\s+$/g, '');\n    };\n\n    /**\n     * Get the corresponding line in textarea for an error\n     * @param {jQuery} $error The error element from preprocess div\n     * @returns {Object} Line information including line number and specific error positions\n     */\n    const getErrorLineInTextarea = ($error) => {\n        const errorText = $error.text().trim();\n        const lines = $textarea.val().split('\\n');\n\n        if (errorText.includes('Course ID')) {\n            const courseIdMatch = errorText.match(/Course ID #(.+) not found/);\n\n            if (courseIdMatch) {\n                const courseId = courseIdMatch[1];\n                const lineIndex = lines.findIndex((line) => {\n                    return line.startsWith('**') && line.includes(courseId);\n                });\n\n                if (lineIndex !== -1) {\n                    const line = lines[lineIndex];\n                    const start = line.indexOf(courseId);\n                    return {\n                        lineNumber: lineIndex,\n                        errorStart: start,\n                        errorEnd: start + courseId.length,\n                    };\n                }\n            }\n        }\n\n        // General error line matching\n        const cleanErrorText = errorText\n            .replace(/^(Error:|Invalid:|Not found:|Course ID)\\s*/i, '')\n            .trim();\n\n        const lineIndex = lines.findIndex((line) => {\n            const cleanLine = line.trim();\n            return (\n                cleanLine &&\n                (cleanErrorText.includes(cleanLine) ||\n                    cleanLine.includes(cleanErrorText))\n            );\n        });\n\n        return {\n            lineNumber: lineIndex,\n            errorStart: -1,\n            errorEnd: -1,\n        };\n    };\n\n    /**\n     * Scroll element into view\n     * @param {Element} element The element to scroll into view\n     */\n    const smoothScrollIntoView = (element) => {\n        const $container = $('#id_familypreprocessdisplay');\n        const containerTop = $container.offset().top;\n        const elementTop = $(element).offset().top;\n        const scroll =\n            elementTop -\n            containerTop -\n            $container.height() / 2 +\n            $(element).height();\n\n        $container.scrollTop($container.scrollTop() + scroll);\n    };\n\n    /**\n     * Highlight specific text in textarea\n     * @param {Object} errorInfo A.I generated doc: Line information including line number and specific error positions.\n     */\n    const highlightTextareaError = (errorInfo) => {\n        if (errorInfo.lineNumber === -1) {\n            return;\n        }\n\n        const lines = $textarea.val().split('\\n');\n        let position = lines\n            .slice(0, errorInfo.lineNumber)\n            .reduce((pos, line) => pos + line.length + 1, 0);\n\n        const textareaElement = $textarea.get(0);\n        textareaElement.focus();\n\n        if (errorInfo.errorStart >= 0 && errorInfo.errorEnd >= 0) {\n            textareaElement.setSelectionRange(\n                position + errorInfo.errorStart,\n                position + errorInfo.errorEnd\n            );\n        } else {\n            textareaElement.setSelectionRange(\n                position,\n                position + lines[errorInfo.lineNumber].length\n            );\n        }\n\n        // Scroll textarea to show highlighted text.\n        const lineHeight = parseInt($textarea.css('line-height'));\n        const scrollPosition = errorInfo.lineNumber * lineHeight;\n        $textarea.scrollTop(scrollPosition - $textarea.height() / 2);\n    };\n\n    /**\n     * Scroll to and highlight specific error.\n     * @param {number} index The index of the error to scroll to.\n     */\n    const scrollToError = (index) => {\n        const $errors = $preprocessDiv.find('.alert-danger');\n        if (index >= 0 && index < $errors.length) {\n            $('.error-highlight').removeClass('error-highlight');\n            const $currentError = $errors.eq(index);\n            $currentError.addClass('error-highlight');\n\n            smoothScrollIntoView($currentError.get(0));\n            highlightTextareaError(getErrorLineInTextarea($currentError));\n        }\n    };\n\n    // Add error highlight styling\n    $('<style>')\n        .text(\n            `\n            .error-highlight {\n                animation: highlight-pulse 1s;\n                box-shadow: 0 0 8px rgba(220, 53, 69, 0.5);\n            }\n            @keyframes highlight-pulse {\n                0% { transform: scale(1); }\n                50% { transform: scale(1.02); }\n                100% { transform: scale(1); }\n            }\n        `\n        )\n        .appendTo('head');\n\n    // Event Handlers\n    $preprocessButton.on('click', async (e) => {\n        e.preventDefault();\n        $textarea.val(cleanInputText($textarea.val()));\n        currentErrorIndex = -1;\n        await processCurrentData();\n    });\n\n    $shownexterrorButton.on('click', async (e) => {\n        e.preventDefault();\n        await processCurrentData();\n        const $errors = $preprocessDiv.find('.alert-danger');\n        if ($errors.length > 0) {\n            currentErrorIndex = (currentErrorIndex + 1) % $errors.length;\n            scrollToError(currentErrorIndex);\n        }\n    });\n\n    $(window).on('resize', () => {\n        $preprocessDiv.css('height', $textarea.outerHeight() + 'px');\n    });\n};\n\n/**\n * Validate and process family data.\n *\n * @param {Object} data - The input data object.\n * @param {string} data.input - The raw input string containing family data.\n * @param {Object} data.partnerships - Partnership data keyed by ID.\n * @param {Object} data.courses - Course data keyed by ID.\n * @return {Promise<string>} The HTML feedback string.\n */\nexport const validateFamilyData = async ({ input, partnerships, courses }) => {\n    courses = Object.assign({}, ...Object.values(courses));\n    if (!input || typeof input !== 'string') {\n        throw new Error(\n            getString(\n                'invalidinput',\n                'local_equipment',\n                getString('expectedanonemptystring', 'local_equipment')\n            )\n        );\n    }\n\n    // This creates and object with text types as keys and regexes to match as values.\n    const regexes = {\n        email: /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/,\n        phone: /^(\\+?\\d{1,2}\\s?)?(\\(?\\d{3}\\)?[\\s.-]?)?\\d{3}[\\s.-]?\\d{4}$/,\n        name: /^[a-zA-ZÀ-ÿ\\u00f1\\u00d1\\u0100-\\u017f\\s'-]+$/,\n        partnership: /^-?\\d+$/,\n        student: /^\\*(?!\\*)(.)/,\n        courses: /^\\*\\*.*$/,\n    };\n\n    /**\n     * Determine the type of text based on regex patterns. Below, we are defining a function that will take the above oject using\n     * and convert it into an array of key/values, so instead of having an object like this:\n     *\n     * textType1: /regex1/\n     * textType2: /regex2/\n     * textType3: /regex3/\n     * textType4: /regex4/\n     *\n     * we will have only the one matched key/value pair returned in the form of an array like this:\n     *\n     * ['textTypeX', /regexX/]\n     * ('X' representing whichever key/value pair was matched).\n     * It's the Object.entries(regexes) function that does all that. Then, the find() function comes in.\n     * The find() function, in this case, destuctures the array that was returned by Object.entries(regexes), skipping the first\n     * element (the key) and assigning the second element (the value) to the variable 'regex', which has the test() function.\n     *\n     * Returns the key of the first element in the array that matches the regex.\n     * So, determineTextType() should return one of the following:\n     * 'email'\n     * 'phone'\n     * 'name'\n     * 'partnership'\n     * 'student'\n     * 'courses'\n     * 'unknown'\n     *\n     * @param {string} line - The line of text to analyze.\n     * @return {string} The determined text type.\n     */\n    const determineTextType = (line) => {\n        for (const [type, regex] of Object.entries(regexes)) {\n            if (regex.test(line)) {\n                if (type === 'phone' && line.length < 10) {\n                    return 'unknown';\n                }\n                return type;\n            }\n        }\n        return 'unknown';\n    };\n\n    /**\n     * Parse a full name string into first, middle, and last name components.\n     *\n     * @param {string} fullName - The full name string to parse\n     * @returns {Object} Object containing name components\n     */\n    const parseName = async (fullName) => {\n        // First, clean up the input by removing extra spaces and standardizing whitespace\n        const cleanName = fullName.trim().replace(/\\s+/g, ' ');\n\n        // Split the name into parts\n        const parts = cleanName.split(' ');\n\n        // Initialize the result object\n        const result = {\n            firstName: '',\n            middleName: '',\n            lastName: '',\n        };\n\n        if (parts.length === 0) {\n            return result;\n        }\n\n        if (parts.length === 1) {\n            // Only one name provided\n            result.firstName = parts[0];\n            return result;\n        }\n\n        if (parts.length === 2) {\n            // First and last name only\n            result.firstName = parts[0];\n            result.lastName = parts[1];\n            return result;\n        }\n\n        // For three or more parts\n        result.firstName = parts[0];\n        result.lastName = parts[parts.length - 1];\n        result.middleName = parts.slice(1, -1).join(' ');\n\n        return result;\n    };\n\n    // Example usage:\n    const processPersonName = async (nameString) => {\n        const {\n            firstName,\n            middleName = null,\n            lastName,\n        } = await parseName(nameString);\n\n        return {\n            firstName,\n            middleName,\n            lastName,\n        };\n    };\n\n    /**\n     * Parse and reformat a phone number into +12345678910 format.\n     * Take any phone number, and turn it into a U.S. phone number.\n     * E.g +1 (234) 567-8910 -> +12345678910\n     * E.g. 234-567-8910 -> +12345678910\n     * E.g. 234.567.8910 -> +12345678910\n     * E.g. 234 567 8910 -> +12345678910\n     * E.g. 2345678910 -> +12345678910\n     * E.g. 12345678910 -> +12345678910\n     * @param {string} phoneNumber - The phone number to reformat.\n     * @return {Object} An object containing the reformatted phone number and any errors.\n     */\n    const parsePhoneNumber = async (phoneNumber) => {\n        let parsedPhoneNumber = phoneNumber.replace(/[()\\-\\s+.]/g, '');\n        if (parsedPhoneNumber.length === 10 && parsedPhoneNumber[0] !== '1') {\n            parsedPhoneNumber = '+1' + parsedPhoneNumber;\n        } else if (\n            parsedPhoneNumber.length === 11 &&\n            parsedPhoneNumber[0] === '1'\n        ) {\n            parsedPhoneNumber = '+' + parsedPhoneNumber;\n        } else {\n            return (\n                '<span class=\"pl-2 pr-2 alert-danger\">' +\n                (await getString(\n                    'invalidphonenumber',\n                    'local_equipment',\n                    parsedPhoneNumber\n                )) +\n                '</span>'\n            );\n        }\n        return parsedPhoneNumber;\n    };\n\n    /**\n     * Process parent information from a line of text.\n     *\n     * @param {string} line - The line of text to process.\n     * @param {string} textType - The type of text determined.\n     * @param {Object} parent - The current parent object.\n     * @return {Object} Updated parent object.\n     */\n    const processParentInfo = async (line, textType, parent) => {\n        parent = {\n            ...parent,\n            [textType]: {\n                html: line,\n                data: line,\n            },\n        };\n        switch (textType) {\n            case 'name': {\n                let nameHTML = line.trim();\n                let names = nameHTML.split(' ');\n                if (names.length === 1) {\n                    // Only one name provided.\n                    nameHTML =\n                        '<span class=\"pl-2 pr-2 alert-danger\">' +\n                        (await getString(\n                            'onlyonenameprovided',\n                            'local_equipment',\n                            nameHTML\n                        )) +\n                        '</span>';\n                }\n                const nameParts = await processPersonName(line);\n\n                parent = {\n                    ...parent,\n                    [textType]: {\n                        data: {\n                            firstName: nameParts.firstName,\n                            middleName: nameParts.middleName,\n                            lastName: nameParts.lastName,\n                        },\n                        html: nameHTML,\n                    },\n                };\n                break;\n            }\n            case 'email':\n                parent[textType].html =\n                    '<span class=\"pl-4 pr-4\">' + line + '</span>';\n                break;\n            case 'phone': {\n                let formattedPhone = await parsePhoneNumber(line);\n                parent[textType].data = formattedPhone;\n                parent[textType].html =\n                    '<span class=\"pl-4 pr-4\">' + formattedPhone + '</span>';\n                break;\n            }\n            default:\n                break;\n        }\n        return parent;\n    };\n\n    /**\n     * Process partnership information from a line of text.\n     *\n     * @param {string} id - The partnership ID.\n     * @return {Object} The partnership object.\n     */\n\n    const processPartnershipInfo = async (id) => {\n        let partnership = {};\n        if (partnerships[id]) {\n            partnership = {\n                data: id,\n                html: partnerships[id].name,\n            };\n        } else {\n            partnership = {\n                data: id,\n                html:\n                    '<span class=\"pl-2 pr-2 alert-danger\">' +\n                    (await getString(\n                        'partnershipnumbernotfound',\n                        'local_equipment',\n                        id\n                    )) +\n                    '</span>',\n            };\n        }\n\n        return {\n            partnership,\n            inStudentSection: true,\n        };\n    };\n\n    /**\n     * Process student information from a line of text.\n     *\n     * @param {string} line - The line of text to process.\n     * @param {string} textType - The type of text determined.\n     * @param {Object} student - The current student object.\n     * @param {string} partnership - The partnership object.\n     * @param {boolean} partnershipAdded - Whether a partnership has been added.\n     * @param {Array} parents - The parent objects.\n     * @return {Object} Updated student object.\n     */\n    const processStudentInfo = async (\n        line,\n        textType,\n        student,\n        partnership,\n        partnershipAdded,\n        parents\n    ) => {\n        student = {\n            ...student,\n            [textType]: {\n                html: line,\n                data: line,\n            },\n        };\n        const parentExists = parents.length > 0;\n\n        switch (textType) {\n            case 'student': {\n                // This refers to the student's name, which is the only line that is preceded by a single asterisk (*).\n                let name = line.replace('*', '').trim();\n                let names = name.split(' ');\n                const nameParts = await processPersonName(name);\n\n                // All users in Moodle need a first and last name. If only one name is provided for the student, we'll automatically\n                // append the first listed parent's last name and warn the admin user about the automated addition; otherwise\n                // display an error message.\n                if (names.length === 1 && parentExists) {\n                    name =\n                        name +\n                        ' ' +\n                        '<span class=\"pl-1 pr-1 alert-warning\">' +\n                        parents[0]?.name?.data?.lastName +\n                        '</span>';\n                } else if (names.length === 1 && !parentExists) {\n                    name =\n                        '<span class=\"pl-2 pr-2 alert-danger\">' +\n                        (await getString(\n                            'onlyonenameprovided',\n                            'local_equipment',\n                            name\n                        )) +\n                        '</span>';\n                }\n\n                student = {\n                    ...student,\n                    [textType]: {\n                        data: {\n                            firstName: nameParts.firstName,\n                            middleName: nameParts.middleName,\n                            lastName: nameParts.lastName,\n                        },\n                        html: name,\n                    },\n                };\n                break;\n            }\n            case 'email':\n                student[textType].data = line;\n                student[textType].html =\n                    '<span class=\"pl-4 pr-4\">' + line + '</span>';\n                break;\n            case 'phone': {\n                let formattedPhone = await parsePhoneNumber(line);\n                student[textType].data = formattedPhone;\n                student[textType].html =\n                    '<span class=\"pl-4 pr-4\">' + formattedPhone + '</span>';\n                break;\n            }\n            case 'courses': {\n                const coursesData = line\n                    .replace('**', '')\n                    .trim()\n                    .split(',')\n                    .map((course) => course.trim());\n                const processedCourses = [];\n\n                const coursesHTML = await Promise.all(\n                    coursesData.map(async (id) => {\n                        const msg = {\n                            c_id: id,\n                            p_id: partnership.data,\n                        };\n                        let courseExistsInPartnership = false;\n                        const courseAlreadyProcessed =\n                            processedCourses.includes(id);\n                        let courseName = '';\n                        if (partnershipAdded) {\n                            courseExistsInPartnership =\n                                partnerships[partnership?.data].coursedata[\n                                    id\n                                ] !== undefined;\n                        }\n                        if (\n                            courses[id] &&\n                            !courseAlreadyProcessed &&\n                            (!partnershipAdded ||\n                                (partnershipAdded && courseExistsInPartnership))\n                        ) {\n                            // This is the successful case.\n                            processedCourses.push(id);\n                            // Below utilizes the EN DASH character: '–' or \\u2013\n                            const enDash = '–';\n                            const regex = new RegExp(`${id} ${enDash} `, 'g');\n                            courseName = courses[id].replace(regex, '');\n                        } else if (\n                            courses[id] &&\n                            courseAlreadyProcessed &&\n                            (!partnershipAdded ||\n                                (partnershipAdded && courseExistsInPartnership))\n                        ) {\n                            processedCourses.push(id);\n                            const errorMessage = await getString(\n                                'coursealreadyadded',\n                                'local_equipment',\n                                msg.c_id\n                            );\n                            courseName = `<span class=\"pl-2 pr-2 alert-danger\">${errorMessage}</span>`;\n                        } else if (\n                            courses[id] &&\n                            partnershipAdded &&\n                            !courseExistsInPartnership\n                        ) {\n                            const errorMessage = await getString(\n                                'courseidnotfoundinpartnership',\n                                'local_equipment',\n                                msg\n                            );\n                            courseName = `<span class=\"pl-2 pr-2 alert-danger\">${errorMessage}</span>`;\n                        } else {\n                            const errorMessage = await getString(\n                                'courseidnotfound',\n                                'local_equipment',\n                                msg.c_id\n                            );\n                            courseName = `<span class=\"pl-2 pr-2 alert-danger\">${errorMessage}</span>`;\n                        }\n\n                        return courseName;\n                    })\n                );\n\n                student[textType].data = coursesData;\n                student[textType].html =\n                    '<span class=\"pl-4 pr-4\">' +\n                    coursesHTML.join(', ') +\n                    '</span>';\n                break;\n            }\n            default:\n                break;\n        }\n        return student;\n    };\n\n    /**\n     * Process a single family's data, a.k.a. a family chunk.\n     *\n     * @param {string} family - The raw family data string.\n     * @return {string} HTML feedback for the family.\n     */\n    const processFamily = async (family) => {\n        try {\n            let parents = [];\n            let students = [];\n            let parent = {};\n            let student = {};\n            let studentName = '';\n            let partnership = {};\n            let inStudentSection = false;\n            let familyHTML = [];\n            let partnershipAdded = false;\n            let parentNum = 0;\n            let studentNum = 0;\n\n            // Trim the shit out of it.\n            const lines = family\n                .split('\\n')\n                .map((line) => line.trim())\n                .filter((line) => line);\n\n            for (const line of lines) {\n                try {\n                    const textType = determineTextType(line);\n\n                    if (textType === 'student') {\n                        inStudentSection = true;\n                    }\n\n                    if (textType === 'unknown') {\n                        const errorString = await getString(\n                            'unrecognizedformat',\n                            'local_equipment',\n                            line\n                        );\n                        familyHTML.push(\n                            `<span class=\"pl-2 alert-danger\">${errorString}</span>`\n                        );\n                        continue;\n                    }\n\n                    if (partnershipAdded && textType === 'partnership') {\n                        const errorString = await getString(\n                            'connotaddmorethanonepartnership',\n                            'local_equipment',\n                            line\n                        );\n                        familyHTML.push(\n                            `<span class=\"pl-2 alert-danger\">${errorString}</span>`\n                        );\n                        continue;\n                    }\n\n                    switch (true) {\n                        case textType === 'partnership': {\n                            const result = await processPartnershipInfo(line);\n                            partnership = result.partnership;\n                            familyHTML.push(partnership.html);\n                            partnershipAdded = true;\n                            break;\n                        }\n                        // This means we are in the parent section.\n                        case !inStudentSection: {\n                            if (textType === 'courses') {\n                                const errorMessage = await getString(\n                                    'thesecoursesneedastudent',\n                                    'local_equipment',\n                                    line\n                                );\n                                familyHTML.push(\n                                    `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`\n                                );\n                                break;\n                            }\n                            parent = await processParentInfo(\n                                line,\n                                textType,\n                                parent\n                            );\n                            if (textType === 'name') {\n                                parents.push({ ...parent });\n                            }\n                            if (parent[textType]) {\n                                familyHTML.push(parent[textType].html);\n                            }\n\n                            if (textType === 'email') {\n                                parents[parentNum] = { ...parent };\n                                parent = {};\n                                parentNum++;\n                            }\n\n                            break;\n                        }\n                        case inStudentSection: {\n                            const result = await processStudentInfo(\n                                line,\n                                textType,\n                                student,\n                                partnership,\n                                partnershipAdded,\n                                parents\n                            );\n                            student = result;\n\n                            if (student[textType]) {\n                                familyHTML.push(student[textType].html);\n                            }\n                            if (textType === 'student') {\n                                studentName = student[textType].data.firstName;\n                                students.push({ ...student });\n                            }\n\n                            if (textType === 'courses') {\n                                const needsEmail =\n                                    parents.length === 0 &&\n                                    student.email === undefined &&\n                                    studentName !== '';\n                                if (needsEmail) {\n                                    const errorMessage = await getString(\n                                        'studentneedsemail',\n                                        'local_equipment',\n                                        studentName\n                                    );\n                                    familyHTML.push(\n                                        `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`\n                                    );\n                                }\n                                // Log.debug('Checking student:');\n                                // const needsStudentName =\n                                //     student.student.data === '' ||\n                                //     student.student.data === undefined;\n                                // if (needsStudentName) {\n                                //     const errorMessage = await getString(\n                                //         'thesecoursesneedastudent',\n                                //         'local_equipment'\n                                //     );\n                                //     familyHTML.push(\n                                //         `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`\n                                //     );\n                                // }\n\n                                // students[studentNum] = { ...student };\n                                students[studentNum] = { ...student };\n                                student = {};\n                                // studentName = '';\n                                studentNum++;\n                            }\n                            break;\n                        }\n                    }\n                } catch (lineError) {\n                    Log.error('Error processing line:');\n                    Log.error(line);\n                    Log.error(lineError);\n                    const errorString = await getString(\n                        'errorprocessingline',\n                        'local_equipment',\n                        line\n                    );\n                    familyHTML.push(\n                        `<span class=\"pl-2 alert-danger\">${errorString}</span>`\n                    );\n                }\n            }\n\n            // Handle any remaining student data\n            if (Object.keys(student).length > 0) {\n                students.push({ ...student });\n            }\n\n            // Log.debug('Checking parents:');\n            // let i = 0;\n            for (parent of parents) {\n                // Log.debug('1');\n                if (parent.email === undefined) {\n                    const errorMessage = await getString(\n                        'parentneedsemail',\n                        'local_equipment',\n                        parent.name.data.firstName\n                    );\n                    Log.debug(errorMessage);\n                    // parent.email.html = `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`;\n                    // parent = {\n                    //     ...parent,\n                    //     email: {\n                    //         data: '',\n                    //         html: `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`,\n                    //     },\n                    // };\n                    familyHTML.unshift(\n                        `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`\n                    );\n                    // parents[i] = parent;\n                }\n                // i++;\n            }\n\n            // if (\n            //     parent.name !== undefined &&\n            //     parent.email === undefined\n            // ) {\n            //     const errorMessage = await getString(\n            //         'parentneedsemail',\n            //         'local_equipment',\n            //         parent.name.data.firstName\n            //     );\n\n            //     familyHTML.push(\n            //         `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`\n            //     );\n            // }\n            if (parents.length !== parentNum) {\n                const errorMessage = await getString(\n                    'errorprocessingparents',\n                    'local_equipment'\n                );\n                familyHTML.unshift(\n                    `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`\n                );\n            }\n\n            if (students.length !== studentNum) {\n                const errorMessage = await getString(\n                    'errorprocessingstudents',\n                    'local_equipment'\n                );\n                familyHTML.unshift(\n                    `<span class=\"pl-2 alert-danger\">${errorMessage}</span>`\n                );\n            }\n\n            const familyData = { parents, students, partnership };\n            const htmlOutput = `<div class=\"bg-light border p-3\">${familyHTML.join(\n                '<br />'\n            )}</div>`;\n\n            return {\n                data: familyData,\n                html: htmlOutput,\n            };\n        } catch (error) {\n            Log.error('Error processing family:', error);\n            const errorString = await getString(\n                'errorprocessingfamily',\n                'local_equipment'\n            );\n            return {\n                data: {},\n                html: `<div class=\"bg-light border p-3\"><span class=\"pl-2 alert-danger\">${errorString}</span></div>`,\n            };\n        }\n    };\n\n    try {\n        const familiesInput = input\n            .split('\\n\\n')\n            .filter((family) => family.trim());\n        const results = await Promise.all(familiesInput.map(processFamily));\n\n        const familiesData = results\n            .map((result) => result.data)\n            .filter(Boolean);\n        const familiesHTML = results.map((result) => result.html);\n\n        Log.debug('Processing complete:');\n        Log.debug({\n            familiesCount: familiesData.length,\n            dataStructure: familiesData,\n            htmlContent: familiesHTML,\n        });\n\n        return {\n            data: familiesData,\n            html: familiesHTML.join('<br>'),\n        };\n    } catch (error) {\n        Log.error('Error in validateFamilyData:', error);\n        const errorMessage = await getString(\n            'errorvalidatingfamilydata',\n            'local_equipment'\n        );\n        return {\n            data: [],\n            html: `<div class=\"alert alert-danger\">${errorMessage}</div>`,\n        };\n    }\n};\n\n/**\n * Rotate the symbol on click.\n *\n */\nexport const rotateSymbol = () => {\n    const headers = document.querySelectorAll(\n        '.local-equipment-notification-header'\n    );\n    headers.forEach((header) => {\n        header.addEventListener('click', () => {\n            const expanded = header.getAttribute('aria-expanded') === 'true';\n            header.setAttribute('aria-expanded', !expanded);\n        });\n    });\n};\n"],"names":["$textarea","$preprocessDiv","$preprocessButton","$shownexterrorContainer","$noerrorsfoundContainer","$shownexterrorButton","find","$noerrorsfoundButton","$submitButton","$partnershipData","$courseData","$familiesDataInput","partnershipDataValue","JSON","parse","attr","courseDataValue","currentErrorIndex","processCurrentData","async","data","input","cleanInputText","val","partnerships","courses","families","validateFamilyData","debug","stringify","html","css","outerHeight","hasErrors","includes","prop","disabled","hidden","scrollToError","error","errorMessage","on","text","replace","index","$errors","length","removeClass","$currentError","eq","addClass","element","$container","containerTop","offset","top","scroll","height","scrollTop","smoothScrollIntoView","get","errorInfo","lineNumber","lines","split","position","slice","reduce","pos","line","textareaElement","focus","errorStart","errorEnd","setSelectionRange","lineHeight","parseInt","scrollPosition","highlightTextareaError","$error","errorText","trim","courseIdMatch","match","courseId","lineIndex","findIndex","startsWith","start","indexOf","cleanErrorText","cleanLine","getErrorLineInTextarea","appendTo","e","preventDefault","window","Object","assign","values","Error","regexes","email","phone","name","partnership","student","determineTextType","type","regex","entries","test","processPersonName","firstName","middleName","lastName","parts","fullName","result","join","parseName","nameString","parsePhoneNumber","parsedPhoneNumber","phoneNumber","processParentInfo","textType","parent","nameHTML","nameParts","formattedPhone","processPartnershipInfo","id","inStudentSection","processStudentInfo","partnershipAdded","parents","parentExists","names","_parents$","_parents$$name","_parents$$name$data","coursesData","map","course","processedCourses","coursesHTML","Promise","all","msg","c_id","p_id","courseExistsInPartnership","courseAlreadyProcessed","courseName","undefined","coursedata","push","enDash","RegExp","processFamily","students","studentName","familyHTML","parentNum","studentNum","family","filter","errorString","lineError","keys","unshift","familiesInput","results","familiesData","Boolean","familiesHTML","familiesCount","dataStructure","htmlContent","document","querySelectorAll","forEach","header","addEventListener","expanded","getAttribute","setAttribute"],"mappings":";;;;;;;4NA8BoB,WAEVA,WAAY,mBAAE,yBACdC,gBAAiB,mBAAE,+BACnBC,mBAAoB,mBAAE,qBACtBC,yBAA0B,mBAAE,4BAC5BC,yBAA0B,mBAAE,4BAC5BC,qBAAuBF,wBAAwBG,KAAK,UACpDC,qBAAuBH,wBAAwBE,KAAK,UACpDE,eAAgB,mBAAE,oBAClBC,kBAAmB,mBAAE,uBACrBC,aAAc,mBAAE,uBAChBC,oBAAqB,mBAAE,oBAGvBC,qBAAuBC,KAAKC,MAC9BL,iBAAiBM,KAAK,sBAEpBC,gBAAkBH,KAAKC,MACzBJ,YAAYK,KAAK,6BAIjBE,mBAAqB,QAKnBC,mBAAqBC,oBAEbC,KAAO,CACTC,MAAOC,eAAetB,UAAUuB,OAChCC,aAAcZ,qBACda,QAAST,iBAGPU,eAAiBC,mBAAmBP,mBACtCQ,MAAM,2BACNA,MAAMF,UACVf,mBAAmBY,IAAIV,KAAKgB,UAAUH,SAASN,OAE/CnB,eAAe6B,KAAKJ,SAASI,MAC7B7B,eAAe8B,IAAI,SAAU/B,UAAUgC,cAAgB,YAEjDC,UAAYP,SAASI,KAAKI,SAAS,gBAGzC7B,qBAAqB8B,KAAK,UAAWF,WACrC5B,qBAAqB8B,KAAK,YAAaF,WACvC1B,qBAAqB4B,KAAK,SAAUF,WACpCzB,cAAc2B,KAAK,WAAYF,WAC/B5B,qBAAqB8B,KAAK,CACtBC,UAAWH,UACXI,QAASJ,YAITA,YAAoC,IAAvBhB,oBACbA,kBAAoB,EACpBqB,cAAcrB,oBAEpB,MAAOsB,oBACDA,MAAM,0BAA2BA,OACrC/B,cAAc2B,KAAK,YAAY,SAEzBK,mBAAqB,mBACvB,4BACA,mBAGJvC,eAAe6B,+CACwBU,0BAM/CvC,eAAe8B,IAAI,SAAU/B,UAAUgC,cAAgB,MAEvDhC,UAAUyC,GAAG,SAAS,KAClBjC,cAAc2B,KAAK,YAAY,YAI7Bb,eAAkBoB,MACfA,MAAwB,iBAATA,KAGbA,KAAKC,QAAQ,aAAc,IAFvB,GAgHTL,cAAiBM,cACbC,QAAU5C,eAAeK,KAAK,oBAChCsC,OAAS,GAAKA,MAAQC,QAAQC,OAAQ,qBACpC,oBAAoBC,YAAY,yBAC5BC,cAAgBH,QAAQI,GAAGL,OACjCI,cAAcE,SAAS,mBAzDDC,CAAAA,gBACpBC,YAAa,mBAAE,+BACfC,aAAeD,WAAWE,SAASC,IAEnCC,QADa,mBAAEL,SAASG,SAASC,IAGnCF,aACAD,WAAWK,SAAW,GACtB,mBAAEN,SAASM,SAEfL,WAAWM,UAAUN,WAAWM,YAAcF,SAiD1CG,CAAqBX,cAAcY,IAAI,IA1CfC,CAAAA,gBACE,IAA1BA,UAAUC,wBAIRC,MAAQ/D,UAAUuB,MAAMyC,MAAM,UAChCC,SAAWF,MACVG,MAAM,EAAGL,UAAUC,YACnBK,QAAO,CAACC,IAAKC,OAASD,IAAMC,KAAKvB,OAAS,GAAG,SAE5CwB,gBAAkBtE,UAAU4D,IAAI,GACtCU,gBAAgBC,QAEZV,UAAUW,YAAc,GAAKX,UAAUY,UAAY,EACnDH,gBAAgBI,kBACZT,SAAWJ,UAAUW,WACrBP,SAAWJ,UAAUY,UAGzBH,gBAAgBI,kBACZT,SACAA,SAAWF,MAAMF,UAAUC,YAAYhB,cAKzC6B,WAAaC,SAAS5E,UAAU+B,IAAI,gBACpC8C,eAAiBhB,UAAUC,WAAaa,WAC9C3E,UAAU0D,UAAUmB,eAAiB7E,UAAUyD,SAAW,IAetDqB,CA9GwBC,CAAAA,eACtBC,UAAYD,OAAOrC,OAAOuC,OAC1BlB,MAAQ/D,UAAUuB,MAAMyC,MAAM,SAEhCgB,UAAU9C,SAAS,aAAc,OAC3BgD,cAAgBF,UAAUG,MAAM,gCAElCD,cAAe,OACTE,SAAWF,cAAc,GACzBG,UAAYtB,MAAMuB,WAAWjB,MACxBA,KAAKkB,WAAW,OAASlB,KAAKnC,SAASkD,gBAG/B,IAAfC,UAAkB,OAEZG,MADOzB,MAAMsB,WACAI,QAAQL,gBACpB,CACHtB,WAAYuB,UACZb,WAAYgB,MACZf,SAAUe,MAAQJ,SAAStC,gBAOrC4C,eAAiBV,UAClBrC,QAAQ,8CAA+C,IACvDsC,aAWE,CACHnB,WAVcC,MAAMuB,WAAWjB,aACzBsB,UAAYtB,KAAKY,cAEnBU,YACCD,eAAexD,SAASyD,YACrBA,UAAUzD,SAASwD,oBAM3BlB,YAAa,EACbC,UAAW,IAoEYmB,CAAuB5C,sCAKpD,WACGN,qXAaAmD,SAAS,QAGd3F,kBAAkBuC,GAAG,SAAStB,MAAAA,IAC1B2E,EAAEC,iBACF/F,UAAUuB,IAAID,eAAetB,UAAUuB,QACvCN,mBAAqB,QACfC,wBAGVb,qBAAqBoC,GAAG,SAAStB,MAAAA,IAC7B2E,EAAEC,uBACI7E,2BACA2B,QAAU5C,eAAeK,KAAK,iBAChCuC,QAAQC,OAAS,IACjB7B,mBAAqBA,kBAAoB,GAAK4B,QAAQC,OACtDR,cAAcrB,2CAIpB+E,QAAQvD,GAAG,UAAU,KACnBxC,eAAe8B,IAAI,SAAU/B,UAAUgC,cAAgB,gBAalDL,mBAAqBR,MAAAA,WAAOE,MAAEA,MAAFG,aAASA,aAATC,QAAuBA,iBAC5DA,QAAUwE,OAAOC,OAAO,MAAOD,OAAOE,OAAO1E,WACxCJ,OAA0B,iBAAVA,YACX,IAAI+E,OACN,mBACI,eACA,mBACA,mBAAU,0BAA2B,2BAM3CC,QAAU,CACZC,MAAO,6BACPC,MAAO,2DACPC,KAAM,8CACNC,YAAa,UACbC,QAAS,eACTjF,QAAS,YAiCPkF,kBAAqBtC,WAClB,MAAOuC,KAAMC,SAAUZ,OAAOa,QAAQT,YACnCQ,MAAME,KAAK1C,YACE,UAATuC,MAAoBvC,KAAKvB,OAAS,GAC3B,UAEJ8D,WAGR,WAiDLI,kBAAoB7F,MAAAA,mBAChB8F,UACFA,UADEC,WAEFA,WAAa,KAFXC,SAGFA,eA5CUhG,OAAAA,iBAKRiG,MAHYC,SAASpC,OAAOtC,QAAQ,OAAQ,KAG1BqB,MAAM,KAGxBsD,OAAS,CACXL,UAAW,GACXC,WAAY,GACZC,SAAU,WAGO,IAAjBC,MAAMtE,OACCwE,OAGU,IAAjBF,MAAMtE,QAENwE,OAAOL,UAAYG,MAAM,GAClBE,QAGU,IAAjBF,MAAMtE,QAENwE,OAAOL,UAAYG,MAAM,GACzBE,OAAOH,SAAWC,MAAM,GACjBE,SAIXA,OAAOL,UAAYG,MAAM,GACzBE,OAAOH,SAAWC,MAAMA,MAAMtE,OAAS,GACvCwE,OAAOJ,WAAaE,MAAMlD,MAAM,GAAI,GAAGqD,KAAK,KAErCD,SASGE,CAAUC,kBAEb,CACHR,UAAAA,UACAC,WAAAA,WACAC,SAAAA,WAgBFO,iBAAmBvG,MAAAA,kBACjBwG,kBAAoBC,YAAYjF,QAAQ,cAAe,OAC1B,KAA7BgF,kBAAkB7E,QAA0C,MAAzB6E,kBAAkB,GACrDA,kBAAoB,KAAOA,sBACxB,CAAA,GAC0B,KAA7BA,kBAAkB7E,QACO,MAAzB6E,kBAAkB,SAKd,8CACO,mBACH,qBACA,kBACAA,mBAEJ,UATJA,kBAAoB,IAAMA,yBAYvBA,mBAWLE,kBAAoB1G,MAAOkD,KAAMyD,SAAUC,iBAC7CA,OAAS,IACFA,QACFD,UAAW,CACRhG,KAAMuC,KACNjD,KAAMiD,OAGNyD,cACC,YACGE,SAAW3D,KAAKY,OAEC,IADT+C,SAAShE,MAAM,KACjBlB,SAENkF,SACI,8CACO,mBACH,sBACA,kBACAA,UAEJ,iBAEFC,gBAAkBjB,kBAAkB3C,MAE1C0D,OAAS,IACFA,QACFD,UAAW,CACR1G,KAAM,CACF6F,UAAWgB,UAAUhB,UACrBC,WAAYe,UAAUf,WACtBC,SAAUc,UAAUd,UAExBrF,KAAMkG,qBAKb,QACDD,OAAOD,UAAUhG,KACb,2BAA6BuC,KAAO,oBAEvC,aACG6D,qBAAuBR,iBAAiBrD,MAC5C0D,OAAOD,UAAU1G,KAAO8G,eACxBH,OAAOD,UAAUhG,KACb,2BAA6BoG,eAAiB,wBAMnDH,QAULI,uBAAyBhH,MAAAA,SACvBsF,YAAc,UAEdA,YADAjF,aAAa4G,IACC,CACVhH,KAAMgH,GACNtG,KAAMN,aAAa4G,IAAI5B,MAGb,CACVpF,KAAMgH,GACNtG,KACI,8CACO,mBACH,4BACA,kBACAsG,IAEJ,WAIL,CACH3B,YAAAA,YACA4B,kBAAkB,IAepBC,mBAAqBnH,MACvBkD,KACAyD,SACApB,QACAD,YACA8B,iBACAC,WAEA9B,QAAU,IACHA,SACFoB,UAAW,CACRhG,KAAMuC,KACNjD,KAAMiD,aAGRoE,aAAeD,QAAQ1F,OAAS,SAE9BgF,cACC,eAEGtB,KAAOnC,KAAK1B,QAAQ,IAAK,IAAIsC,OAC7ByD,MAAQlC,KAAKxC,MAAM,WACjBiE,gBAAkBjB,kBAAkBR,0DAKrB,IAAjBkC,MAAM5F,QAAgB2F,aACtBjC,KACIA,KAAAA,6DAGAgC,QAAQ,gDAARG,UAAYnC,4DAAZoC,eAAkBxH,2CAAlByH,oBAAwB1B,UACxB,eACoB,IAAjBuB,MAAM5F,QAAiB2F,eAC9BjC,KACI,8CACO,mBACH,sBACA,kBACAA,MAEJ,WAGRE,QAAU,IACHA,SACFoB,UAAW,CACR1G,KAAM,CACF6F,UAAWgB,UAAUhB,UACrBC,WAAYe,UAAUf,WACtBC,SAAUc,UAAUd,UAExBrF,KAAM0E,iBAKb,QACDE,QAAQoB,UAAU1G,KAAOiD,KACzBqC,QAAQoB,UAAUhG,KACd,2BAA6BuC,KAAO,oBAEvC,aACG6D,qBAAuBR,iBAAiBrD,MAC5CqC,QAAQoB,UAAU1G,KAAO8G,eACzBxB,QAAQoB,UAAUhG,KACd,2BAA6BoG,eAAiB,oBAGjD,iBACKY,YAAczE,KACf1B,QAAQ,KAAM,IACdsC,OACAjB,MAAM,KACN+E,KAAKC,QAAWA,OAAO/D,SACtBgE,iBAAmB,GAEnBC,kBAAoBC,QAAQC,IAC9BN,YAAYC,KAAI5H,MAAAA,WACNkI,IAAM,CACRC,KAAMlB,GACNmB,KAAM9C,YAAYrF,UAElBoI,2BAA4B,QAC1BC,uBACFR,iBAAiB/G,SAASkG,QAC1BsB,WAAa,MACbnB,mBACAiB,+BAGUG,IAFNnI,aAAaiF,MAAAA,mBAAAA,YAAarF,MAAMwI,WAC5BxB,KAIR3G,QAAQ2G,MACPqB,0BACClB,kBACGA,kBAAoBiB,2BAC3B,CAEEP,iBAAiBY,KAAKzB,UAEhB0B,OAAS,IACTjD,MAAQ,IAAIkD,iBAAU3B,eAAM0B,YAAW,KAC7CJ,WAAajI,QAAQ2G,IAAIzF,QAAQkE,MAAO,SACrC,GACHpF,QAAQ2G,KACRqB,0BACElB,kBACGA,kBAAoBiB,2BAC3B,CACEP,iBAAiBY,KAAKzB,UAChB5F,mBAAqB,mBACvB,qBACA,kBACA6G,IAAIC,MAERI,0DAAqDlH,6BAClD,GACHf,QAAQ2G,KACRG,mBACCiB,0BACH,OACQhH,mBAAqB,mBACvB,gCACA,kBACA6G,KAEJK,0DAAqDlH,4BAClD,OACGA,mBAAqB,mBACvB,mBACA,kBACA6G,IAAIC,MAERI,0DAAqDlH,+BAGlDkH,eAIfhD,QAAQoB,UAAU1G,KAAO0H,YACzBpC,QAAQoB,UAAUhG,KACd,2BACAoH,YAAY3B,KAAK,MACjB,wBAMLb,SASLsD,cAAgB7I,MAAAA,iBAEVqH,QAAU,GACVyB,SAAW,GACXlC,OAAS,GACTrB,QAAU,GACVwD,YAAc,GACdzD,YAAc,GACd4B,kBAAmB,EACnB8B,WAAa,GACb5B,kBAAmB,EACnB6B,UAAY,EACZC,WAAa,QAGXtG,MAAQuG,OACTtG,MAAM,MACN+E,KAAK1E,MAASA,KAAKY,SACnBsF,QAAQlG,MAASA,WAEjB,MAAMA,QAAQN,gBAEL+D,SAAWnB,kBAAkBtC,SAElB,YAAbyD,WACAO,kBAAmB,GAGN,YAAbP,SAAwB,OAClB0C,kBAAoB,mBACtB,qBACA,kBACAnG,MAEJ8F,WAAWN,+CAC4BW,oCAKvCjC,kBAAiC,gBAAbT,SAA4B,OAC1C0C,kBAAoB,mBACtB,kCACA,kBACAnG,MAEJ8F,WAAWN,+CAC4BW,yCAKnC,OACc,gBAAb1C,SAEDrB,mBADqB0B,uBAAuB9D,OACvBoC,YACrB0D,WAAWN,KAAKpD,YAAY3E,MAC5ByG,kBAAmB,aAIjBF,oBACe,YAAbP,SAAwB,OAClBtF,mBAAqB,mBACvB,2BACA,kBACA6B,MAEJ8F,WAAWN,+CAC4BrH,+BAI3CuF,aAAeF,kBACXxD,KACAyD,SACAC,QAEa,SAAbD,UACAU,QAAQqB,KAAK,IAAK9B,SAElBA,OAAOD,WACPqC,WAAWN,KAAK9B,OAAOD,UAAUhG,MAGpB,UAAbgG,WACAU,QAAQ4B,WAAa,IAAKrC,QAC1BA,OAAS,GACTqC,wBAKH/B,oBASD3B,cARqB4B,mBACjBjE,KACAyD,SACApB,QACAD,YACA8B,iBACAC,SAIA9B,QAAQoB,WACRqC,WAAWN,KAAKnD,QAAQoB,UAAUhG,MAErB,YAAbgG,WACAoC,YAAcxD,QAAQoB,UAAU1G,KAAK6F,UACrCgD,SAASJ,KAAK,IAAKnD,WAGN,YAAboB,SAAwB,IAED,IAAnBU,QAAQ1F,aACU6G,IAAlBjD,QAAQJ,OACQ,KAAhB4D,YACY,OACN1H,mBAAqB,mBACvB,oBACA,kBACA0H,aAEJC,WAAWN,+CAC4BrH,yBAkB3CyH,SAASI,YAAc,IAAK3D,SAC5BA,QAAU,GAEV2D,oBAKd,MAAOI,wBACDlI,MAAM,uCACNA,MAAM8B,mBACN9B,MAAMkI,iBACJD,kBAAoB,mBACtB,sBACA,kBACAnG,MAEJ8F,WAAWN,+CAC4BW,4BAY1CzC,UAND9B,OAAOyE,KAAKhE,SAAS5D,OAAS,GAC9BmH,SAASJ,KAAK,IAAKnD,UAKR8B,iBAEUmB,IAAjB5B,OAAOzB,MAAqB,OACtB9D,mBAAqB,mBACvB,mBACA,kBACAuF,OAAOvB,KAAKpF,KAAK6F,wBAEjBrF,MAAMY,cASV2H,WAAWQ,kDAC4BnI,4BAqB3CgG,QAAQ1F,SAAWsH,UAAW,OACxB5H,mBAAqB,mBACvB,yBACA,mBAEJ2H,WAAWQ,kDAC4BnI,4BAIvCyH,SAASnH,SAAWuH,WAAY,OAC1B7H,mBAAqB,mBACvB,0BACA,mBAEJ2H,WAAWQ,kDAC4BnI,+BASpC,CACHpB,KANe,CAAEoH,QAAAA,QAASyB,SAAAA,SAAUxD,YAAAA,aAOpC3E,gDANmDqI,WAAW5C,KAC9D,qBAON,MAAOhF,oBACDA,MAAM,2BAA4BA,aAChCiI,kBAAoB,mBACtB,wBACA,yBAEG,CACHpJ,KAAM,GACNU,gFAA0E0I,0CAM5EI,cAAgBvJ,MACjB2C,MAAM,QACNuG,QAAQD,QAAWA,OAAOrF,SACzB4F,cAAgB1B,QAAQC,IAAIwB,cAAc7B,IAAIiB,gBAE9Cc,aAAeD,QAChB9B,KAAKzB,QAAWA,OAAOlG,OACvBmJ,OAAOQ,SACNC,aAAeH,QAAQ9B,KAAKzB,QAAWA,OAAOxF,2BAEhDF,MAAM,qCACNA,MAAM,CACNqJ,cAAeH,aAAahI,OAC5BoI,cAAeJ,aACfK,YAAaH,eAGV,CACH5J,KAAM0J,aACNhJ,KAAMkJ,aAAazD,KAAK,SAE9B,MAAOhF,oBACDA,MAAM,+BAAgCA,aACpCC,mBAAqB,mBACvB,4BACA,yBAEG,CACHpB,KAAM,GACNU,+CAAyCU,+FASzB,KACR4I,SAASC,iBACrB,wCAEIC,SAASC,SACbA,OAAOC,iBAAiB,SAAS,WACvBC,SAAoD,SAAzCF,OAAOG,aAAa,iBACrCH,OAAOI,aAAa,iBAAkBF"}