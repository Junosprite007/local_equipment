{"version":3,"file":"vccsubmission_addstudents_form.min.js","sources":["../src/vccsubmission_addstudents_form.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the add students form.\n *\n * @module     local_equipment/vccsubmission_addstudents_form\n * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>\n * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport { get_string as getString } from 'core/str';\nimport Log from 'core/log';\n\n/**\n * Initialize the add students form functionality.\n */\nexport const init = () => {\n    Log.debug('Add Student Form JS initialized');\n    setupStudentsHandling();\n};\n\n/**\n * Set up students handling.\n */\nconst setupStudentsHandling = () => {\n    const selector = \"fieldset[id^='id_studentheader_']\";\n\n    $(document).on('click', '.local-equipment-remove-student', function () {\n        const $fieldset = $(this).closest(selector);\n        $fieldset.remove();\n        updateStudentNumbers();\n        updateHiddenFields();\n        renumberFormElements();\n        updateTrashIcons();\n    });\n\n    updateTrashIcons();\n};\n\n/**\n * Update student numbers.\n */\nconst updateStudentNumbers = () => {\n    $('.local-equipment-student-header').each((index, element) => {\n        getString('student', 'local_equipment', index + 1)\n            .then((string) => {\n                $(element).text(string);\n            })\n            .catch((error) => {\n                Log.error('Error updating student header:', error);\n            });\n    });\n};\n\n/**\n * Update hidden fields.\n */\nconst updateHiddenFields = () => {\n    const studentsCount = $(\"fieldset[id^='id_studentheader_']\").length;\n    $('input[name=\"students\"]').val(studentsCount);\n\n    // Update the URL if necessary\n    const url = new URL(window.location.href);\n    url.searchParams.set('repeatno', studentsCount);\n    window.history.replaceState({}, '', url);\n};\n\n/**\n * Renumber form elements.\n */\nconst renumberFormElements = () => {\n    $(\"fieldset[id^='id_studentheader_']\").each((index, fieldset) => {\n        $(fieldset)\n            .find('input, select, textarea')\n            .each((_, element) => {\n                const name = $(element).attr('name');\n                if (name) {\n                    const newName = name.replace(/\\[\\d+\\]/, `[${index}]`);\n                    $(element).attr('name', newName);\n                }\n                const id = $(element).attr('id');\n                if (id) {\n                    const newId = id.replace(/_\\d+_/, `_${index}_`);\n                    $(element).attr('id', newId);\n                }\n            });\n    });\n};\n\n/**\n * Update trash icons visibility.\n */\nconst updateTrashIcons = () => {\n    const students = $(\"fieldset[id^='id_studentheader_']\");\n    if (students.length > 1) {\n        $('.local-equipment-remove-student').show();\n    } else {\n        $('.local-equipment-remove-student').hide();\n    }\n};\n"],"names":["debug","setupStudentsHandling","document","on","this","closest","remove","updateStudentNumbers","updateHiddenFields","renumberFormElements","updateTrashIcons","each","index","element","then","string","text","catch","error","studentsCount","length","val","url","URL","window","location","href","searchParams","set","history","replaceState","fieldset","find","_","name","attr","newName","replace","id","newId","show","hide"],"mappings":";;;;;;;0KA8BoB,kBACZA,MAAM,mCACVC,+BAMEA,sBAAwB,yBAGxBC,UAAUC,GAAG,QAAS,mCAAmC,YACrC,mBAAEC,MAAMC,QAHb,qCAIHC,SACVC,uBACAC,qBACAC,uBACAC,sBAGJA,oBAMEH,qBAAuB,yBACvB,mCAAmCI,MAAK,CAACC,MAAOC,+BACpC,UAAW,kBAAmBD,MAAQ,GAC3CE,MAAMC,6BACDF,SAASG,KAAKD,WAEnBE,OAAOC,qBACAA,MAAM,iCAAkCA,cAQtDV,mBAAqB,WACjBW,eAAgB,mBAAE,qCAAqCC,2BAC3D,0BAA0BC,IAAIF,qBAG1BG,IAAM,IAAIC,IAAIC,OAAOC,SAASC,MACpCJ,IAAIK,aAAaC,IAAI,WAAYT,eACjCK,OAAOK,QAAQC,aAAa,GAAI,GAAIR,MAMlCb,qBAAuB,yBACvB,qCAAqCE,MAAK,CAACC,MAAOmB,gCAC9CA,UACGC,KAAK,2BACLrB,MAAK,CAACsB,EAAGpB,iBACAqB,MAAO,mBAAErB,SAASsB,KAAK,WACzBD,KAAM,OACAE,QAAUF,KAAKG,QAAQ,qBAAezB,gCAC1CC,SAASsB,KAAK,OAAQC,eAEtBE,IAAK,mBAAEzB,SAASsB,KAAK,SACvBG,GAAI,OACEC,MAAQD,GAAGD,QAAQ,mBAAazB,gCACpCC,SAASsB,KAAK,KAAMI,eASpC7B,iBAAmB,MACJ,mBAAE,qCACNU,OAAS,sBAChB,mCAAmCoB,2BAEnC,mCAAmCC"}