/**
 * Mass text form JavaScript functionality.
 *
 * @module     local_equipment/mass_text_form
 * @copyright  2025 onwards Joshua Kirby <josh@funlearningcompany.com>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("local_equipment/mass_text_form",["jquery","core/ajax","core/notification","core/log"],(function($,Ajax,Notification,Log){return{init:function(){const messageTextarea=$("#id_message"),charCountDisplay=$("#char-counter"),recipientCountDisplay=$("#recipient-count"),formElement=$("#mass-text-form"),maxLength=parseInt(messageTextarea.data("max-length"))||250;if(!messageTextarea.length||!charCountDisplay.length)return void Log.debug("local_equipment/mass_text_form: Required elements not found");const updateCharCount=function(){const currentLength=messageTextarea.val().length,remaining=maxLength-currentLength;remaining>=0?charCountDisplay.text(remaining+" characters remaining"):charCountDisplay.text(Math.abs(remaining)+" characters over limit"),remaining<0?charCountDisplay.removeClass("text-warning text-muted").addClass("text-danger"):remaining<20?charCountDisplay.removeClass("text-muted text-danger").addClass("text-warning"):charCountDisplay.removeClass("text-danger text-warning").addClass("text-muted")},handleFormSubmit=function(e){const message=messageTextarea.val().trim();return 0===message.length?(e.preventDefault(),Notification.addNotification({message:"Please enter a message",type:"error"}),!1):message.length>maxLength?(e.preventDefault(),Notification.addNotification({message:"Message is too long. Maximum "+maxLength+" characters allowed",type:"error"}),!1):!!confirm("Are you sure you want to send this message to all parents?")||(e.preventDefault(),!1)};messageTextarea.on("input keyup paste",updateCharCount),updateCharCount(),recipientCountDisplay.length&&Ajax.call([{methodname:"local_equipment_get_recipient_count",args:{},done:function(response){Log.debug("Web service response:",response),response.success?(recipientCountDisplay.text(response.count+" parents"),0===response.count?recipientCountDisplay.removeClass("text-success").addClass("text-warning"):recipientCountDisplay.removeClass("text-warning").addClass("text-success")):(recipientCountDisplay.text("Error loading count"),recipientCountDisplay.removeClass("text-success text-warning").addClass("text-danger"),Log.error("local_equipment/mass_text_form: Recipient count error: "+response.error))},fail:function(error){Log.debug("Web service error details:",error),recipientCountDisplay.text("Error loading count"),recipientCountDisplay.removeClass("text-success text-warning").addClass("text-danger"),Log.error("local_equipment/mass_text_form: Web service error loading recipient count: "+(error.message||"Unknown error"))}}]),formElement.length?formElement.on("submit",handleFormSubmit):($("form").on("submit",handleFormSubmit),Log.debug("local_equipment/mass_text_form: Using fallback form selector"))}}}));

//# sourceMappingURL=mass_text_form.min.js.map