{"version":3,"file":"addpartnerships_form copy.min.js","sources":["../src/addpartnerships_form copy.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the add partnerships form.\n *\n * @module     local_equipment/addpartnerships_form\n * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>\n * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport { get_string as getString } from 'core/str';\nimport Log from 'core/log';\n\n/**\n * Initialize the add partnerships form functionality.\n */\nexport const init = () => {\n    Log.debug('Add Partnership Form JS initialized');\n    setupPartnershipsHandling();\n};\n\n/**\n * Set up partnerships handling.\n */\nconst setupPartnershipsHandling = () => {\n    const selector = \"fieldset[id^='id_partnershipheader_']\";\n\n    $(document).on('click', '.local-equipment-remove-partnership', function () {\n        const $fieldset = $(this).closest(selector);\n        $fieldset.remove();\n        updatePartnershipNumbers();\n        updateHiddenFields();\n        renumberFormElements();\n        updateTrashIcons();\n    });\n\n    updateTrashIcons();\n};\n\n/**\n * Update partnership numbers.\n */\nconst updatePartnershipNumbers = () => {\n    $('.local-equipment-partnership-header').each((index, element) => {\n        getString('partnership', 'local_equipment', index + 1)\n            .then((string) => {\n                $(element).text(string);\n            })\n            .catch((error) => {\n                Log.error('Error updating partnership header:', error);\n            });\n    });\n};\n\n/**\n * Update hidden fields.\n */\nconst updateHiddenFields = () => {\n    const partnershipsCount = $(\"fieldset[id^='id_partnershipheader_']\").length;\n    $('input[name=\"partnerships\"]').val(partnershipsCount);\n\n    // Update the URL if necessary\n    const url = new URL(window.location.href);\n    url.searchParams.set('repeatno', partnershipsCount);\n    window.history.replaceState({}, '', url);\n};\n\n/**\n * Renumber form elements.\n */\nconst renumberFormElements = () => {\n    $(\"fieldset[id^='id_partnershipheader_']\").each((index, fieldset) => {\n        $(fieldset)\n            .find('input, select, textarea')\n            .each((_, element) => {\n                const name = $(element).attr('name');\n                if (name) {\n                    const newName = name.replace(/\\[\\d+\\]/, `[${index}]`);\n                    $(element).attr('name', newName);\n                }\n                const id = $(element).attr('id');\n                if (id) {\n                    const newId = id.replace(/_\\d+_/, `_${index}_`);\n                    $(element).attr('id', newId);\n                }\n            });\n    });\n};\n\n/**\n * Update trash icons visibility.\n */\nconst updateTrashIcons = () => {\n    const partnerships = $(\"fieldset[id^='id_partnershipheader_']\");\n    if (partnerships.length > 1) {\n        $('.local-equipment-remove-partnership').show();\n    } else {\n        $('.local-equipment-remove-partnership').hide();\n    }\n};\n"],"names":["debug","setupPartnershipsHandling","document","on","this","closest","remove","updatePartnershipNumbers","updateHiddenFields","renumberFormElements","updateTrashIcons","each","index","element","then","string","text","catch","error","partnershipsCount","length","val","url","URL","window","location","href","searchParams","set","history","replaceState","fieldset","find","_","name","attr","newName","replace","id","newId","show","hide"],"mappings":";;;;;;;0KA8BoB,kBACZA,MAAM,uCACVC,mCAMEA,0BAA4B,yBAG5BC,UAAUC,GAAG,QAAS,uCAAuC,YACzC,mBAAEC,MAAMC,QAHb,yCAIHC,SACVC,2BACAC,qBACAC,uBACAC,sBAGJA,oBAMEH,yBAA2B,yBAC3B,uCAAuCI,MAAK,CAACC,MAAOC,+BACxC,cAAe,kBAAmBD,MAAQ,GAC/CE,MAAMC,6BACDF,SAASG,KAAKD,WAEnBE,OAAOC,qBACAA,MAAM,qCAAsCA,cAQ1DV,mBAAqB,WACjBW,mBAAoB,mBAAE,yCAAyCC,2BACnE,8BAA8BC,IAAIF,yBAG9BG,IAAM,IAAIC,IAAIC,OAAOC,SAASC,MACpCJ,IAAIK,aAAaC,IAAI,WAAYT,mBACjCK,OAAOK,QAAQC,aAAa,GAAI,GAAIR,MAMlCb,qBAAuB,yBACvB,yCAAyCE,MAAK,CAACC,MAAOmB,gCAClDA,UACGC,KAAK,2BACLrB,MAAK,CAACsB,EAAGpB,iBACAqB,MAAO,mBAAErB,SAASsB,KAAK,WACzBD,KAAM,OACAE,QAAUF,KAAKG,QAAQ,qBAAezB,gCAC1CC,SAASsB,KAAK,OAAQC,eAEtBE,IAAK,mBAAEzB,SAASsB,KAAK,SACvBG,GAAI,OACEC,MAAQD,GAAGD,QAAQ,mBAAazB,gCACpCC,SAASsB,KAAK,KAAMI,eASpC7B,iBAAmB,MACA,mBAAE,yCACNU,OAAS,sBACpB,uCAAuCoB,2BAEvC,uCAAuCC"}