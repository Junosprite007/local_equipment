{"version":3,"file":"virtualcourseconsent_form.min.js","sources":["../src/virtualcourseconsent_form.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the virtual course consent form.\n *\n * @module     local_equipment/virtualcourseconsent_form\n * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>\n * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport { get_string as getString } from 'core/str';\nimport Ajax from 'core/ajax';\n\n/**\n * Initialize the virtual course consent form functionality.\n */\nexport const init = () => {\n    setupPickupMethodToggle();\n    setupDynamicCourseSelection();\n    setupStudentEmailGeneration();\n};\n\n/**\n * Set up the toggle for pickup method fields.\n */\nconst setupPickupMethodToggle = () => {\n    const $pickupMethod = $('#id_pickupmethod');\n    const $otherPickupFields = $(\n        '#id_pickuppersonname, #id_pickuppersonphone, #id_pickuppersondetails'\n    ).closest('.form-group');\n\n    const toggleOtherPickupFields = () => {\n        if ($pickupMethod.val() === 'other') {\n            $otherPickupFields.show();\n        } else {\n            $otherPickupFields.hide();\n        }\n    };\n\n    $pickupMethod.on('change', toggleOtherPickupFields);\n    toggleOtherPickupFields(); // Initial state\n};\n\n/**\n * Set up dynamic course selection based on partnership.\n */\nconst setupDynamicCourseSelection = () => {\n    const $partnership = $('#id_partnership');\n    const $courseSelects = $(\n        'select[name^=\"studentrepeats\"][name$=\"[student_courses]\"]'\n    );\n\n    $partnership.on('change', () => {\n        const partnershipId = $partnership.val();\n        if (partnershipId) {\n            Ajax.call([\n                {\n                    methodname: 'local_equipment_get_partnership_courses',\n                    args: { partnershipid: partnershipId },\n                    done: (courses) => {\n                        $courseSelects.empty();\n                        Object.entries(courses).forEach(([id, name]) => {\n                            $courseSelects.append(\n                                $('<option>').val(id).text(name)\n                            );\n                        });\n                    },\n                    fail: (error) => {\n                        // eslint-disable-next-line no-console\n                        console.error('Error fetching courses:', error);\n                    },\n                },\n            ]);\n        }\n    });\n};\n\n/**\n * Set up student email generation.\n */\nconst setupStudentEmailGeneration = () => {\n    $('input[name$=\"[student_email]\"]').each((_, emailInput) => {\n        const $email = $(emailInput);\n        const $firstName = $email\n            .closest('.fgroup')\n            .find('input[name$=\"[student_firstname]\"]');\n\n        $firstName.on('blur', () => {\n            if (!$email.val()) {\n                const parentEmail = $('input[name=\"email\"]').val();\n                const studentFirstName = $firstName.val().toLowerCase();\n                const generatedEmail = parentEmail.replace(\n                    '@',\n                    `+${studentFirstName}@`\n                );\n                $email.val(generatedEmail);\n                getString('studentemailgenerated', 'local_equipment')\n                    .then((string) => {\n                        $email\n                            .closest('.form-group')\n                            .append(\n                                `<div class=\"form-text text-muted\">${string}</div>`\n                            );\n                    })\n                    .catch((error) => {\n                        // eslint-disable-next-line no-console\n                        console.error('Error fetching string:', error);\n                    });\n            }\n        });\n    });\n};\n"],"names":["setupPickupMethodToggle","setupDynamicCourseSelection","setupStudentEmailGeneration","$pickupMethod","$otherPickupFields","closest","toggleOtherPickupFields","val","show","hide","on","$partnership","$courseSelects","partnershipId","call","methodname","args","partnershipid","done","courses","empty","Object","entries","forEach","_ref","id","name","append","text","fail","error","console","each","_","emailInput","$email","$firstName","find","parentEmail","studentFirstName","toLowerCase","generatedEmail","replace","then","string","catch"],"mappings":";;;;;;;4KA8BoB,KAChBA,0BACAC,8BACAC,qCAMEF,wBAA0B,WACtBG,eAAgB,mBAAE,oBAClBC,oBAAqB,mBACvB,wEACFC,QAAQ,eAEJC,wBAA0B,KACA,UAAxBH,cAAcI,MACdH,mBAAmBI,OAEnBJ,mBAAmBK,QAI3BN,cAAcO,GAAG,SAAUJ,yBAC3BA,2BAMEL,4BAA8B,WAC1BU,cAAe,mBAAE,mBACjBC,gBAAiB,mBACnB,6DAGJD,aAAaD,GAAG,UAAU,WAChBG,cAAgBF,aAAaJ,MAC/BM,6BACKC,KAAK,CACN,CACIC,WAAY,0CACZC,KAAM,CAAEC,cAAeJ,eACvBK,KAAOC,UACHP,eAAeQ,QACfC,OAAOC,QAAQH,SAASI,SAAQC,WAAEC,GAAIC,WAClCd,eAAee,QACX,mBAAE,YAAYpB,IAAIkB,IAAIG,KAAKF,WAIvCG,KAAOC,QAEHC,QAAQD,MAAM,0BAA2BA,eAW3D5B,4BAA8B,yBAC9B,kCAAkC8B,MAAK,CAACC,EAAGC,oBACnCC,QAAS,mBAAED,YACXE,WAAaD,OACd9B,QAAQ,WACRgC,KAAK,sCAEVD,WAAW1B,GAAG,QAAQ,SACbyB,OAAO5B,MAAO,OACT+B,aAAc,mBAAE,uBAAuB/B,MACvCgC,iBAAmBH,WAAW7B,MAAMiC,cACpCC,eAAiBH,YAAYI,QAC/B,eACIH,uBAERJ,OAAO5B,IAAIkC,oCACD,wBAAyB,mBAC9BE,MAAMC,SACHT,OACK9B,QAAQ,eACRsB,mDACwCiB,qBAGhDC,OAAOf,QAEJC,QAAQD,MAAM,yBAA0BA"}