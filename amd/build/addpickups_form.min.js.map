{"version":3,"file":"addpickups_form.min.js","sources":["../src/addpickups_form.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for managing multiple pickups in the add pickups form.\n *\n * @module      local_equipment/addpickup_form\n * @copyright   2024 onward Joshua Kirby <josh@funlearningcompany.com>\n * @author      Joshua Kirby - CTO @ Fun Learning Company - funlearningcompany.com\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([\"jquery\", \"core/str\"], function ($, Str) {\n    return {\n        init: function () {\n            var module = this;\n\n            $(document).ready(function () {\n                module.updatePickupNumbers();\n                module.updateTrashIcons();\n\n                $(document).on(\n                    \"click\",\n                    \".local-equipment-remove-pickup\",\n                    function (e) {\n                        e.preventDefault();\n                        module.removePickup($(this));\n                    }\n                );\n\n                $(\"#id_addpickup\").on(\"click\", function () {\n                    setTimeout(function () {\n                        module.updatePickupNumbers();\n                        module.updateTrashIcons();\n                    }, 100);\n                });\n            });\n        },\n\n        updatePickupNumbers: function () {\n            $(\".local-equipment-pickup-header\").each(function (index) {\n                Str.get_string(\"pickup\", \"local_equipment\", index + 1).then(\n                    function (string) {\n                        $(this).text(string);\n                    }.bind(this)\n                );\n            });\n        },\n\n        updateTrashIcons: function () {\n            var pickups = $('fieldset[id^=\"id_pickupheader_\"]');\n            if (pickups.length > 1) {\n                $(\".local-equipment-remove-pickup\").show();\n            } else {\n                $(\".local-equipment-remove-pickup\").hide();\n            }\n        },\n\n        removePickup: function (button) {\n            var pickup = button.closest(\"fieldset\");\n            pickup.remove();\n            this.updatePickupNumbers();\n            this.updateTrashIcons();\n            this.updateHiddenFields();\n        },\n\n        updateHiddenFields: function () {\n            var pickupCount = $('fieldset[id^=\"id_pickupheader_\"]').length;\n            $('input[name=\"pickups\"]').val(pickupCount);\n\n            var url = new URL(window.location.href);\n            url.searchParams.set(\"repeatno\", pickupCount);\n            window.history.replaceState({}, \"\", url);\n        },\n    };\n});\n"],"names":["define","$","Str","init","module","this","document","ready","updatePickupNumbers","updateTrashIcons","on","e","preventDefault","removePickup","setTimeout","each","index","get_string","then","string","text","bind","length","show","hide","button","closest","remove","updateHiddenFields","pickupCount","val","url","URL","window","location","href","searchParams","set","history","replaceState"],"mappings":";;;;;;;;AAwBAA,yCAAO,CAAC,SAAU,aAAa,SAAUC,EAAGC,WACjC,CACHC,KAAM,eACEC,OAASC,KAEbJ,EAAEK,UAAUC,OAAM,WACdH,OAAOI,sBACPJ,OAAOK,mBAEPR,EAAEK,UAAUI,GACR,QACA,kCACA,SAAUC,GACNA,EAAEC,iBACFR,OAAOS,aAAaZ,EAAEI,UAI9BJ,EAAE,iBAAiBS,GAAG,SAAS,WAC3BI,YAAW,WACPV,OAAOI,sBACPJ,OAAOK,qBACR,YAKfD,oBAAqB,WACjBP,EAAE,kCAAkCc,MAAK,SAAUC,OAC/Cd,IAAIe,WAAW,SAAU,kBAAmBD,MAAQ,GAAGE,KACnD,SAAUC,QACNlB,EAAEI,MAAMe,KAAKD,SACfE,KAAKhB,WAKnBI,iBAAkB,WACAR,EAAE,oCACJqB,OAAS,EACjBrB,EAAE,kCAAkCsB,OAEpCtB,EAAE,kCAAkCuB,QAI5CX,aAAc,SAAUY,QACPA,OAAOC,QAAQ,YACrBC,cACFnB,2BACAC,wBACAmB,sBAGTA,mBAAoB,eACZC,YAAc5B,EAAE,oCAAoCqB,OACxDrB,EAAE,yBAAyB6B,IAAID,iBAE3BE,IAAM,IAAIC,IAAIC,OAAOC,SAASC,MAClCJ,IAAIK,aAAaC,IAAI,WAAYR,aACjCI,OAAOK,QAAQC,aAAa,GAAI,GAAIR"}