{"version":3,"file":"addpickups_form.min.js","sources":["../src/addpickups_form.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for the add pickups form.\n *\n * @module     local_equipment/addpickups_form\n * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>\n * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport { get_string as getString } from 'core/str';\nimport Log from 'core/log';\n\n/**\n * Initialize the add pickups form functionality.\n */\nexport const init = () => {\n    Log.debug('Add Pickups Form JS initialized');\n    setupPickupsHandling();\n};\n\n/**\n * Set up pickups handling.\n */\nconst setupPickupsHandling = () => {\n    const selector = \"fieldset[id^='id_pickupheader_']\";\n\n    $(document).on('click', '.local-equipment-remove-pickup', function () {\n        const $fieldset = $(this).closest(selector);\n        const removedFieldset = $fieldset.remove();\n        Log.debug('Fieldset removed');\n        Log.debug(\n            \"Here's what returned from the '$fieldset.remove()' command:\"\n        );\n        Log.debug(removedFieldset);\n        updatePickupNumbers();\n        updateHiddenFields();\n        renumberFormElements();\n        updateTrashIcons();\n    });\n\n    updateTrashIcons();\n};\n\n/**\n * Update pickup numbers.\n */\nconst updatePickupNumbers = () => {\n    $('.local-equipment-pickup-header').each((index, element) => {\n        getString('pickup', 'local_equipment', index + 1)\n            .then((string) => {\n                $(element).text(string);\n            })\n            .catch((error) => {\n                Log.error('Error updating pickup header:', error);\n            });\n    });\n};\n\n/**\n * Update hidden fields.\n */\nconst updateHiddenFields = () => {\n    const pickupsCount = $(\"fieldset[id^='id_pickupheader_']\").length;\n    $('input[name=\"pickups\"]').val(pickupsCount);\n\n    // Update the URL if necessary\n    const url = new URL(window.location.href);\n    url.searchParams.set('repeatno', pickupsCount);\n    window.history.replaceState({}, '', url);\n};\n\n/**\n * Renumber form elements.\n */\nconst renumberFormElements = () => {\n    $(\"fieldset[id^='id_pickupheader_']\").each((index, fieldset) => {\n        Log.debug(`Renumbering fieldset ${index}`);\n        $(fieldset)\n            .find('input, select, textarea')\n            .each((_, element) => {\n                const name = $(element).attr('name');\n                if (name) {\n                    const newName = name.replace(/\\[\\d+\\]/, `[${index}]`);\n                    $(element).attr('name', newName);\n                }\n                const id = $(element).attr('id');\n                if (id) {\n                    const newId = id.replace(/_\\d+_/, `_${index}_`);\n                    $(element).attr('id', newId);\n                }\n            });\n    });\n};\n\n/**\n * Update trash icons visibility.\n */\nconst updateTrashIcons = () => {\n    const pickups = $(\"fieldset[id^='id_pickupheader_']\");\n    if (pickups.length > 1) {\n        $('.local-equipment-remove-pickup').show();\n    } else {\n        $('.local-equipment-remove-pickup').hide();\n    }\n};\n"],"names":["debug","setupPickupsHandling","document","on","removedFieldset","this","closest","remove","updatePickupNumbers","updateHiddenFields","renumberFormElements","updateTrashIcons","each","index","element","then","string","text","catch","error","pickupsCount","length","val","url","URL","window","location","href","searchParams","set","history","replaceState","fieldset","find","_","name","attr","newName","replace","id","newId","show","hide"],"mappings":";;;;;;;0KA8BoB,kBACZA,MAAM,mCACVC,8BAMEA,qBAAuB,yBAGvBC,UAAUC,GAAG,QAAS,kCAAkC,iBAEhDC,iBADY,mBAAEC,MAAMC,QAHb,oCAIqBC,sBAC9BP,MAAM,iCACNA,MACA,4EAEAA,MAAMI,iBACVI,sBACAC,qBACAC,uBACAC,sBAGJA,oBAMEH,oBAAsB,yBACtB,kCAAkCI,MAAK,CAACC,MAAOC,+BACnC,SAAU,kBAAmBD,MAAQ,GAC1CE,MAAMC,6BACDF,SAASG,KAAKD,WAEnBE,OAAOC,qBACAA,MAAM,gCAAiCA,cAQrDV,mBAAqB,WACjBW,cAAe,mBAAE,oCAAoCC,2BACzD,yBAAyBC,IAAIF,oBAGzBG,IAAM,IAAIC,IAAIC,OAAOC,SAASC,MACpCJ,IAAIK,aAAaC,IAAI,WAAYT,cACjCK,OAAOK,QAAQC,aAAa,GAAI,GAAIR,MAMlCb,qBAAuB,yBACvB,oCAAoCE,MAAK,CAACC,MAAOmB,yBAC3ChC,qCAA8Ba,4BAChCmB,UACGC,KAAK,2BACLrB,MAAK,CAACsB,EAAGpB,iBACAqB,MAAO,mBAAErB,SAASsB,KAAK,WACzBD,KAAM,OACAE,QAAUF,KAAKG,QAAQ,qBAAezB,gCAC1CC,SAASsB,KAAK,OAAQC,eAEtBE,IAAK,mBAAEzB,SAASsB,KAAK,SACvBG,GAAI,OACEC,MAAQD,GAAGD,QAAQ,mBAAazB,gCACpCC,SAASsB,KAAK,KAAMI,eASpC7B,iBAAmB,MACL,mBAAE,oCACNU,OAAS,sBACf,kCAAkCoB,2BAElC,kCAAkCC"}