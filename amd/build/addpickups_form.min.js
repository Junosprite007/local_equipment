define("local_equipment/addpickups_form",["exports","jquery","core/str","core/log"],(function(_exports,_jquery,_str,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JavaScript for the add pickups form.
   *
   * @module     local_equipment/addpickups_form
   * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_log=_interopRequireDefault(_log);_exports.init=()=>{_log.default.debug("Add Pickups Form JS initialized"),setupPickupsHandling()};const setupPickupsHandling=()=>{(0,_jquery.default)(document).on("click",".local-equipment-remove-pickup",(function(){const removedFieldset=(0,_jquery.default)(this).closest("fieldset[id^='id_pickupheader_']").remove();_log.default.debug("Fieldset removed"),_log.default.debug("Here's what returned from the '$fieldset.remove()' command:"),_log.default.debug(removedFieldset),updatePickupNumbers(),updateHiddenFields(),renumberFormElements(),updateTrashIcons()})),updateTrashIcons()},updatePickupNumbers=()=>{(0,_jquery.default)(".local-equipment-pickup-header").each(((index,element)=>{(0,_str.get_string)("pickup","local_equipment",index+1).then((string=>{(0,_jquery.default)(element).text(string)})).catch((error=>{_log.default.error("Error updating pickup header:",error)}))}))},updateHiddenFields=()=>{const pickupsCount=(0,_jquery.default)("fieldset[id^='id_pickupheader_']").length;(0,_jquery.default)('input[name="pickups"]').val(pickupsCount);const url=new URL(window.location.href);url.searchParams.set("repeatno",pickupsCount),window.history.replaceState({},"",url)},renumberFormElements=()=>{(0,_jquery.default)("fieldset[id^='id_pickupheader_']").each(((index,fieldset)=>{_log.default.debug("Renumbering fieldset ".concat(index)),(0,_jquery.default)(fieldset).find("input, select, textarea").each(((_,element)=>{const name=(0,_jquery.default)(element).attr("name");if(name){const newName=name.replace(/\[\d+\]/,"[".concat(index,"]"));(0,_jquery.default)(element).attr("name",newName)}const id=(0,_jquery.default)(element).attr("id");if(id){const newId=id.replace(/_\d+_/,"_".concat(index,"_"));(0,_jquery.default)(element).attr("id",newId)}}))}))},updateTrashIcons=()=>{(0,_jquery.default)("fieldset[id^='id_pickupheader_']").length>1?(0,_jquery.default)(".local-equipment-remove-pickup").show():(0,_jquery.default)(".local-equipment-remove-pickup").hide()}}));

//# sourceMappingURL=addpickups_form.min.js.map