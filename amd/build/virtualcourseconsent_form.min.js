define("local_equipment/virtualcourseconsent_form",["exports","jquery","core/str","core/ajax"],(function(_exports,_jquery,_str,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JavaScript for the virtual course consent form.
   *
   * @module     local_equipment/virtualcourseconsent_form
   * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax);_exports.init=()=>{setupPickupMethodToggle(),setupDynamicCourseSelection(),setupStudentEmailGeneration(),setupExchangeLocationFiltering()};const setupPickupMethodToggle=()=>{const $pickupMethod=(0,_jquery.default)("#id_pickupmethod"),$otherPickupFields=(0,_jquery.default)("#id_pickuppersonname, #id_pickuppersonphone, #id_pickuppersondetails").closest(".mb-3"),toggleOtherPickupFields=()=>{"other"===$pickupMethod.val()?$otherPickupFields.show():$otherPickupFields.hide()};$pickupMethod.on("change",toggleOtherPickupFields),toggleOtherPickupFields()},setupDynamicCourseSelection=()=>{const $partnership=(0,_jquery.default)("#id_partnership"),$courseSelects=(0,_jquery.default)('select[name^="studentrepeats"][name$="[student_courses]"]');$partnership.on("change",(()=>{const partnershipId=$partnership.val();partnershipId&&_ajax.default.call([{methodname:"local_equipment_get_partnership_courses",args:{partnershipid:partnershipId},done:courses=>{$courseSelects.empty(),Object.entries(courses).forEach((_ref=>{let[id,name]=_ref;$courseSelects.append((0,_jquery.default)("<option>").val(id).text(name))}))},fail:error=>{console.error("Error fetching courses:",error)}}])}))},setupStudentEmailGeneration=()=>{(0,_jquery.default)('input[name$="[student_email]"]').each(((_,emailInput)=>{const $email=(0,_jquery.default)(emailInput),$firstName=$email.closest(".fgroup").find('input[name$="[student_firstname]"]');$firstName.on("blur",(()=>{if(!$email.val()){const parentEmail=(0,_jquery.default)('input[name="email"]').val(),studentFirstName=$firstName.val().toLowerCase(),generatedEmail=parentEmail.replace("@","+".concat(studentFirstName,"@"));$email.val(generatedEmail),(0,_str.get_string)("studentemailgenerated","local_equipment").then((string=>{$email.closest(".mb-3").append('<div class="form-text text-muted">'.concat(string,"</div>"))})).catch((error=>{console.error("Error fetching string:",error)}))}}))}))},setupExchangeLocationFiltering=()=>{const $exchangeLocation=(0,_jquery.default)("#id_exchange_partnershipid"),$pickupTime=(0,_jquery.default)("#id_pickup"),allPickupOptions=$pickupTime.find("option").clone(),filterPickupTimes=()=>{const selectedPartnershipId=$exchangeLocation.val();$pickupTime.empty(),$pickupTime.append(allPickupOptions.filter('[value="0"]').clone()),selectedPartnershipId&&""!==selectedPartnershipId&&allPickupOptions.each((function(){const $option=(0,_jquery.default)(this),optionValue=$option.val(),optionText=$option.text();if("0"!==optionValue&&""!==optionValue){const partnershipName=$exchangeLocation.find("option:selected").text().split(" â€” ")[0];optionText.includes(partnershipName)&&$pickupTime.append($option.clone())}})),$pickupTime.val("0")};$exchangeLocation.on("change",filterPickupTimes),filterPickupTimes()}}));

//# sourceMappingURL=virtualcourseconsent_form.min.js.map