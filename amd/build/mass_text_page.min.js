define("local_equipment/mass_text_page",["exports","core/ajax","core/notification","core/log"],(function(_exports,_ajax,_notification,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Mass text messaging page JavaScript functionality.
   *
   * @module     local_equipment/mass_text_page
   * @copyright  2025 onwards Joshua Kirby <josh@funlearningcompany.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification),_log=_interopRequireDefault(_log);var _default={init:()=>{let retryCount=0;const initializePage=()=>{const messageTextarea=document.querySelector('textarea[name="message"]')||document.querySelector("#id_message")||document.querySelector('textarea[id*="message"]'),charCountDisplay=document.querySelector("#char-counter")||document.querySelector('[id*="char-counter"]')||document.querySelector(".char-counter"),recipientCountDisplay=document.querySelector("#recipient-count")||document.querySelector('[id*="recipient-count"]')||document.querySelector(".recipient-count"),form=document.querySelector("form"),submitButton=document.querySelector('input[type="submit"]');if(!messageTextarea)return retryCount++,retryCount<50?(_log.default.debug("local_equipment/mass_text_page: Message textarea not found, retrying... (".concat(retryCount,"/").concat(50,")")),void setTimeout(initializePage,100)):void _log.default.error("local_equipment/mass_text_page: Message textarea not found after maximum retries. Page initialization failed.");_log.default.debug("local_equipment/mass_text_page: Elements found, initializing...");const maxLength=parseInt(messageTextarea.dataset.maxLength)||250,updateCharCount=()=>{if(!charCountDisplay)return;const currentLength=messageTextarea.value.length,remaining=maxLength-currentLength;charCountDisplay.textContent=remaining>=0?"".concat(remaining," characters remaining"):"".concat(Math.abs(remaining)," characters over limit"),charCountDisplay.classList.remove("text-danger","text-warning","text-muted"),remaining<0?charCountDisplay.classList.add("text-danger"):remaining<20?charCountDisplay.classList.add("text-warning"):charCountDisplay.classList.add("text-muted")},loadRecipientCount=()=>{recipientCountDisplay&&_ajax.default.call([{methodname:"local_equipment_get_recipient_count",args:{}}])[0].then((response=>{_log.default.debug("Web service response:",response),response.success?(recipientCountDisplay.textContent="".concat(response.count," parents"),recipientCountDisplay.className="badge bg-secondary",0===response.count?(recipientCountDisplay.classList.remove("bg-secondary"),recipientCountDisplay.classList.add("bg-warning")):(recipientCountDisplay.classList.remove("bg-warning"),recipientCountDisplay.classList.add("bg-success"))):(recipientCountDisplay.textContent="Error loading count",recipientCountDisplay.className="badge bg-danger",_log.default.error("local_equipment/mass_text_page: Recipient count error:",response.error))})).catch((error=>{_log.default.debug("Web service error details:",error),recipientCountDisplay.textContent="Error loading count",recipientCountDisplay.className="badge bg-danger",_log.default.error("local_equipment/mass_text_page: Web service error:",error.message||"Unknown error")}))},handleFormSubmit=e=>{const message=messageTextarea.value.trim();return 0===message.length?(e.preventDefault(),_notification.default.addNotification({message:"Please enter a message",type:"error"}),!1):message.length>maxLength?(e.preventDefault(),_notification.default.addNotification({message:"Message is too long. Maximum ".concat(maxLength," characters allowed"),type:"error"}),!1):confirm("Are you sure you want to send this message to all parents with verified phone numbers?")?(submitButton&&(submitButton.disabled=!0,submitButton.value="Sending Messages..."),!0):(e.preventDefault(),!1)};messageTextarea&&(messageTextarea.addEventListener("input",updateCharCount),messageTextarea.addEventListener("keyup",updateCharCount),messageTextarea.addEventListener("paste",(()=>{setTimeout(updateCharCount,10)})),updateCharCount()),loadRecipientCount(),form&&form.addEventListener("submit",handleFormSubmit);const successAlert=document.querySelector(".alert-success"),warningAlert=document.querySelector(".alert-warning");(successAlert||warningAlert)&&(messageTextarea&&(messageTextarea.value="",updateCharCount()),submitButton&&(submitButton.disabled=!1,submitButton.value="Send Messages"),loadRecipientCount(),window.scrollTo({top:0,behavior:"smooth"}));document.querySelectorAll(".alert-dismissible").forEach((alert=>{setTimeout((()=>{const closeButton=alert.querySelector(".btn-close");closeButton&&closeButton.click()}),1e4)}))};initializePage()}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=mass_text_page.min.js.map