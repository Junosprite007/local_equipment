{"version":3,"file":"profile_partnership_field.min.js","sources":["../src/profile_partnership_field.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Javascript for enhancing the partnership profile field with autocomplete.\n *\n * @module     local_equipment/profile_partnership_field\n * @copyright  2024 Your Name <your@email.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Ajax from 'core/ajax';\nimport Notification from 'core/notification';\nimport { get_string as getString } from 'core/str';\n\n/**\n * Initialize the partnership field enhancement.\n */\nexport const init = async () => {\n    // Target the specific partnership field select element.\n    const $select = $('#id_profile_field_partnership');\n    if (!$select.length) {\n        return;\n    }\n\n    try {\n        // Get required strings.\n        const [searchPlaceholder, noPartnershipsFound] = await Promise.all([\n            getString('searchpartnerships', 'local_equipment'),\n            getString('nopartnershipsfound', 'local_equipment'),\n        ]);\n\n        // Create and insert search input.\n        const $searchInput = $('<input>', {\n            type: 'text',\n            class: 'form-control mb-2',\n            placeholder: searchPlaceholder,\n        });\n\n        $select.before($searchInput);\n        $select.css('display', 'none');\n\n        // Create results container.\n        const $results = $('<div>', {\n            class: 'list-group mt-1',\n        });\n        $searchInput.after($results);\n\n        // Set initial value if one exists.\n        const currentValue = $select.val();\n        if (currentValue) {\n            $searchInput.val($select.find('option:selected').text());\n        }\n\n        /**\n         * Fetch and display partnership results.\n         * @param {string} query - The search query\n         */\n        const fetchResults = async (query) => {\n            try {\n                const response = await Ajax.call([\n                    {\n                        methodname: 'local_equipment_get_partnerships',\n                        args: { query },\n                    },\n                ])[0];\n\n                $results.empty();\n\n                if (response.results?.length) {\n                    response.results.forEach(({ id, text }) => {\n                        const $item = $('<a>', {\n                            href: '#',\n                            class: 'list-group-item list-group-item-action',\n                            text,\n                            'data-value': id,\n                        });\n\n                        $item.on('click', (e) => {\n                            e.preventDefault();\n                            $select.val(id);\n                            $searchInput.val(text);\n                            $results.empty();\n                        });\n\n                        $results.append($item);\n                    });\n                } else {\n                    $results.append(\n                        $('<div>', {\n                            class: 'list-group-item disabled',\n                            text: noPartnershipsFound,\n                        })\n                    );\n                }\n            } catch (error) {\n                Notification.exception(error);\n            }\n        };\n\n        // Debounce the search to prevent too many requests.\n        let searchTimeout;\n        $searchInput.on('input', (e) => {\n            const query = e.target.value;\n            clearTimeout(searchTimeout);\n\n            if (query.length < 2) {\n                $results.empty();\n                return;\n            }\n\n            searchTimeout = setTimeout(() => {\n                fetchResults(query);\n            }, 300);\n        });\n\n        // Handle clicking outside.\n        $(document).on('click', (e) => {\n            if (!$(e.target).closest($searchInput.parent()).length) {\n                $results.empty();\n            }\n        });\n    } catch (error) {\n        Notification.exception(error);\n    }\n};\n"],"names":["async","$select","length","searchPlaceholder","noPartnershipsFound","Promise","all","$searchInput","type","class","placeholder","before","css","$results","after","val","find","text","fetchResults","response","Ajax","call","methodname","args","query","empty","results","_response$results","forEach","_ref","id","$item","href","on","e","preventDefault","append","error","exception","searchTimeout","target","value","clearTimeout","setTimeout","document","closest","parent"],"mappings":";;;;;;;gOA+BoBA,gBAEVC,SAAU,mBAAE,oCACbA,QAAQC,iBAMFC,kBAAmBC,2BAA6BC,QAAQC,IAAI,EAC/D,mBAAU,qBAAsB,oBAChC,mBAAU,sBAAuB,qBAI/BC,cAAe,mBAAE,UAAW,CAC9BC,KAAM,OACNC,MAAO,oBACPC,YAAaP,oBAGjBF,QAAQU,OAAOJ,cACfN,QAAQW,IAAI,UAAW,cAGjBC,UAAW,mBAAE,QAAS,CACxBJ,MAAO,oBAEXF,aAAaO,MAAMD,UAGEZ,QAAQc,OAEzBR,aAAaQ,IAAId,QAAQe,KAAK,mBAAmBC,cAO/CC,aAAelB,MAAAA,wCAEPmB,eAAiBC,cAAKC,KAAK,CAC7B,CACIC,WAAY,mCACZC,KAAM,CAAEC,MAAAA,UAEb,GAEHX,SAASY,kCAELN,SAASO,sCAATC,kBAAkBzB,OAClBiB,SAASO,QAAQE,SAAQC,WAACC,GAAEA,GAAFb,KAAMA,iBACtBc,OAAQ,mBAAE,MAAO,CACnBC,KAAM,IACNvB,MAAO,yCACPQ,KAAAA,kBACca,KAGlBC,MAAME,GAAG,SAAUC,IACfA,EAAEC,iBACFlC,QAAQc,IAAIe,IACZvB,aAAaQ,IAAIE,MACjBJ,SAASY,WAGbZ,SAASuB,OAAOL,UAGpBlB,SAASuB,QACL,mBAAE,QAAS,CACP3B,MAAO,2BACPQ,KAAMb,uBAIpB,MAAOiC,6BACQC,UAAUD,aAK3BE,cACJhC,aAAa0B,GAAG,SAAUC,UAChBV,MAAQU,EAAEM,OAAOC,MACvBC,aAAaH,eAETf,MAAMtB,OAAS,EACfW,SAASY,QAIbc,cAAgBI,YAAW,KACvBzB,aAAaM,SACd,4BAILoB,UAAUX,GAAG,SAAUC,KAChB,mBAAEA,EAAEM,QAAQK,QAAQtC,aAAauC,UAAU5C,QAC5CW,SAASY,WAGnB,MAAOY,6BACQC,UAAUD"}