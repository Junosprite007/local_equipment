{"version":3,"file":"addpartnership_form.min.js","sources":["../src/addpartnership_form.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for deleting partnerships in the add partnerships form.\n *\n * @module      local_equipment/addpartnership_form\n * @copyright   2024 onward Joshua Kirby <josh@funlearningcompany.com>\n * @author      Joshua Kirby - CTO @ Fun Learning Company - funlearningcompany.com\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n*/\n\ndefine([\"jquery\", \"core/log\", \"core/str\"], ($, log, Str) => {\n    return {\n        init: () => {\n            log.debug(\"Add Partnership Form JS initialized\");\n\n            const updatePartnershipNumbers = () => {\n                $(\".partnership-header\").each((index, element) => {\n                    Str.get_string(\"partnership\", \"local_equipment\", index + 1)\n                        .then((string) => {\n                            $(element).text(string);\n                        })\n                        .catch((error) => {\n                            log.error(\n                                \"Error updating partnership header:\",\n                                error\n                            );\n                        });\n                });\n            };\n\n            const updateHiddenFields = () => {\n                const partnershipsCount = $(\"fieldset\").length;\n                $('input[name=\"partnerships\"]').val(partnershipsCount);\n\n                // Update the URL if necessary\n                const url = new URL(window.location.href);\n                url.searchParams.set(\"repeatno\", partnershipsCount);\n                window.history.replaceState({}, \"\", url);\n            };\n\n            const renumberFormElements = () => {\n                $(\"fieldset\").each((index, fieldset) => {\n                    $(fieldset)\n                        .find(\"input, select, textarea\")\n                        .each((_, element) => {\n                            const name = $(element).attr(\"name\");\n                            if (name) {\n                                const newName = name.replace(\n                                    /\\[\\d+\\]/,\n                                    `[${index}]`\n                                );\n                                $(element).attr(\"name\", newName);\n                            }\n                            const id = $(element).attr(\"id\");\n                            if (id) {\n                                const newId = id.replace(/_\\d+_/, `_${index}_`);\n                                $(element).attr(\"id\", newId);\n                            }\n                        });\n                });\n            };\n\n            const updateTrashIcons = () => {\n                const partnerships = $(\"fieldset\");\n                if (partnerships.length > 1) {\n                    $(\".remove-partnership\").show();\n                } else {\n                    $(\".remove-partnership\").hide();\n                }\n            };\n\n            updateTrashIcons();\n\n            $(document).on(\"click\", \".remove-partnership\", function () {\n                const $fieldset = $(this).closest(\"fieldset\");\n                // const isFirstPartnership = $fieldset.is(\":first-of-type\");\n\n                // if (isFirstPartnership) {\n                //     Str.get_string(\n                //         \"cannotremovefirstpartnership\",\n                //         \"local_equipment\"\n                //     )\n                //         .then((string) => {\n                //             alert(string);\n                //         })\n                //         .catch((error) => {\n                //             log.error(\"Error getting string:\", error);\n                //         });\n                //     return;\n                // }\n\n                $fieldset.remove();\n                updatePartnershipNumbers();\n                updateHiddenFields();\n                renumberFormElements();\n                updateTrashIcons();\n            });\n        },\n    };\n});\n\n"],"names":["define","$","log","Str","init","debug","updateTrashIcons","length","show","hide","document","on","this","closest","remove","each","index","element","get_string","then","string","text","catch","error","partnershipsCount","val","url","URL","window","location","href","searchParams","set","history","replaceState","updateHiddenFields","fieldset","find","_","name","attr","newName","replace","id","newId"],"mappings":";;;;;;;;AAwBAA,6CAAO,CAAC,SAAU,WAAY,aAAa,CAACC,EAAGC,IAAKC,OACzC,CACHC,KAAM,KACFF,IAAIG,MAAM,6CAiDJC,iBAAmB,KACAL,EAAE,YACNM,OAAS,EACtBN,EAAE,uBAAuBO,OAEzBP,EAAE,uBAAuBQ,QAIjCH,mBAEAL,EAAES,UAAUC,GAAG,QAAS,uBAAuB,WACzBV,EAAEW,MAAMC,QAAQ,YAiBxBC,SA3EVb,EAAE,uBAAuBc,MAAK,CAACC,MAAOC,WAClCd,IAAIe,WAAW,cAAe,kBAAmBF,MAAQ,GACpDG,MAAMC,SACHnB,EAAEgB,SAASI,KAAKD,WAEnBE,OAAOC,QACJrB,IAAIqB,MACA,qCACAA,aAMO,YACjBC,kBAAoBvB,EAAE,YAAYM,OACxCN,EAAE,8BAA8BwB,IAAID,yBAG9BE,IAAM,IAAIC,IAAIC,OAAOC,SAASC,MACpCJ,IAAIK,aAAaC,IAAI,WAAYR,mBACjCI,OAAOK,QAAQC,aAAa,GAAI,GAAIR,MAwDpCS,GApDAlC,EAAE,YAAYc,MAAK,CAACC,MAAOoB,YACvBnC,EAAEmC,UACGC,KAAK,2BACLtB,MAAK,CAACuB,EAAGrB,iBACAsB,KAAOtC,EAAEgB,SAASuB,KAAK,WACzBD,KAAM,OACAE,QAAUF,KAAKG,QACjB,qBACI1B,YAERf,EAAEgB,SAASuB,KAAK,OAAQC,eAEtBE,GAAK1C,EAAEgB,SAASuB,KAAK,SACvBG,GAAI,OACEC,MAAQD,GAAGD,QAAQ,mBAAa1B,YACtCf,EAAEgB,SAASuB,KAAK,KAAMI,cAuCtCtC"}