define("local_equipment/addpartnerships_form",["exports","jquery","core/str","core/log"],(function(_exports,_jquery,_str,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JavaScript for the add partnerships form.
   *
   * @module     local_equipment/addpartnerships_form
   * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=_exports.displayPartnershipCourseListing=void 0,_jquery=_interopRequireDefault(_jquery),_log=_interopRequireDefault(_log);_exports.init=()=>{_log.default.debug("Add Partnership Form JS initialized"),setupPartnershipsHandling()};const setupPartnershipsHandling=()=>{(0,_jquery.default)(document).on("click",".local-equipment-remove-partnership",(function(){const $fieldset=(0,_jquery.default)(this).closest("fieldset[id^='id_partnershipheader_']"),containerId=$fieldset.find("select[id^='id_partnershipcourselist_']").attr("id").replace("partnershipcourselist","courses");(0,_jquery.default)("#".concat(containerId)).remove(),$fieldset.remove(),updatePartnershipNumbers(),updateHiddenFields(),renumberFormElements(),updateTrashIcons()})),updateTrashIcons()},updatePartnershipNumbers=()=>{(0,_jquery.default)(".local-equipment-partnership-header").each(((index,element)=>{(0,_str.get_string)("partnership","local_equipment",index+1).then((string=>{(0,_jquery.default)(element).text(string)})).catch((error=>{_log.default.error("Error updating partnership header:",error)}))}))},updateHiddenFields=()=>{const partnershipsCount=(0,_jquery.default)("fieldset[id^='id_partnershipheader_']").length;(0,_jquery.default)('input[name="partnerships"]').val(partnershipsCount);const url=new URL(window.location.href);url.searchParams.set("repeatno",partnershipsCount),window.history.replaceState({},"",url)},renumberFormElements=()=>{(0,_jquery.default)("fieldset[id^='id_partnershipheader_']").each(((index,fieldset)=>{(0,_jquery.default)(fieldset).find("input, select, textarea").each(((_,element)=>{const name=(0,_jquery.default)(element).attr("name");if(name){const newName=name.replace(/\[\d+\]/,"[".concat(index,"]"));(0,_jquery.default)(element).attr("name",newName)}const id=(0,_jquery.default)(element).attr("id");if(id){const newId=id.replace(/_\d+_/,"_".concat(index,"_"));(0,_jquery.default)(element).attr("id",newId)}}))}))},updateTrashIcons=()=>{(0,_jquery.default)("fieldset[id^='id_partnershipheader_']").length>1?(0,_jquery.default)(".local-equipment-remove-partnership").show():(0,_jquery.default)(".local-equipment-remove-partnership").hide()};_exports.displayPartnershipCourseListing=()=>{const coursesData=JSON.parse((0,_jquery.default)("#id_coursesthisyear").attr("data-coursesthisyear")),initializePartnershipSelect=async $select=>{const containerId=$select.attr("id").replace("partnershipcourselist","courses");let $container=(0,_jquery.default)("#".concat(containerId));$container.length||($container=(0,_jquery.default)("<div>",{id:containerId,class:"local-equipment_partnership-courses-container mt-3"}),$select.after($container));const strings=await Promise.all([(0,_str.get_string)("nocoursesfoundforthispartnership","local_equipment"),(0,_str.get_string)("courseid","local_equipment"),(0,_str.get_string)("coursename","local_equipment"),(0,_str.get_string)("totalcourses","local_equipment")]),[noCoursesFound,courseIdLabel,courseNameLabel,totalCoursesLabel]=strings,displayCourses=partnershipId=>{$container.empty();const partnershipCourses=coursesData[partnershipId];partnershipCourses&&0!==Object.keys(partnershipCourses).length||$container.html('<div class="alert alert-warning">'.concat(noCoursesFound,"</div>"));const $mainContainer=(0,_jquery.default)("<div>").addClass("local-equipment_main-courses-container"),$header=(0,_jquery.default)("<div>").addClass("local-equipment_courses-header").append((0,_jquery.default)("<div>").addClass("local-equipment_courses-header-row d-flex").append((0,_jquery.default)("<div>").addClass("local-equipment_course-id-col").text(courseIdLabel),(0,_jquery.default)("<div>").addClass("local-equipment_course-name-col").text(courseNameLabel))),$scrollContent=(0,_jquery.default)("<div>").addClass("local-equipment_courses-scroll-content"),$scrollTable=(0,_jquery.default)("<div>").addClass("local-equipment_courses-table"),sortedCourseIds=Object.keys(partnershipCourses).sort(((a,b)=>parseInt(a)-parseInt(b)));sortedCourseIds.forEach((courseId=>{(0,_jquery.default)("<div>").addClass("local-equipment_course-row d-flex").append((0,_jquery.default)("<div>").addClass("local-equipment_course-id-col").text(courseId),(0,_jquery.default)("<div>").addClass("local-equipment_course-name-col").text(partnershipCourses[courseId])).appendTo($scrollTable)})),$scrollContent.append($scrollTable);const $footer=(0,_jquery.default)("<div>").addClass("local-equipment_courses-footer").text("".concat(totalCoursesLabel,": ").concat(sortedCourseIds.length));$mainContainer.append($header).append($scrollContent).append($footer),$container.append($mainContainer)};$select.on("change",(function(){const selectedPartnership=(0,_jquery.default)(this).val();selectedPartnership?displayCourses(selectedPartnership):$container.empty()}));const initialPartnership=$select.val();initialPartnership&&displayCourses(initialPartnership)};(0,_jquery.default)("select[id^='id_partnershipcourselist_']").each((function(){initializePartnershipSelect((0,_jquery.default)(this))})),(0,_jquery.default)(document).on("click",'[name="addpartnership"]',(function(){setTimeout((()=>{const $newSelect=(0,_jquery.default)("select[id^='id_partnershipcourselist_']:last");$newSelect.length&&initializePartnershipSelect($newSelect)}),100)}))}}));

//# sourceMappingURL=addpartnerships_form.min.js.map