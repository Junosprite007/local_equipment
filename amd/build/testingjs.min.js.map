{"version":3,"file":"testingjs.min.js","sources":["../src/testingjs.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for deleting partnerships in the add partnerships form.\n *\n * @module      local_equipment/addpartnership_form\n * @copyright   2024 onward Joshua Kirby <josh@funlearningcompany.com>\n * @author      Joshua Kirby - CTO @ Fun Learning Company - funlearningcompany.com\n * @license     https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from \"jquery\";\nimport log from \"core/log\";\nimport * as Str from \"core/str\";\n\nexport const init = () => {\n    $(function () {\n        log.debug(\"Add Partnership Form JS initialized\");\n\n        const updatePartnershipNumbers = () => {\n            $(\".local-equipment-partnership-header\").each((index, element) => {\n                Str.get_string(\"partnership\", \"local_equipment\", index + 1)\n                    .then((string) => {\n                        $(element).text(string);\n                    })\n                    .catch((error) => {\n                        log.error(\"Error updating partnership header:\", error);\n                    });\n            });\n        };\n\n        const updateHiddenFields = () => {\n            log.debug(\"updateHiddenFields\");\n            const partnershipsCount = $(\"fieldset\").length;\n            log.debug(`Number of fieldsets: ${partnershipsCount}`);\n            $('input[name=\"partnerships\"]').val(partnershipsCount);\n\n            // Update the URL if necessary\n            const url = new URL(window.location.href);\n            url.searchParams.set(\"repeatno\", partnershipsCount);\n            window.history.replaceState({}, \"\", url);\n        };\n\n        const renumberFormElements = () => {\n            log.debug(\"renumberFormElements\");\n            $(\"fieldset\").each((index, fieldset) => {\n                log.debug(`Renumbering fieldset ${index}`);\n                $(fieldset)\n                    .find(\"input, select, textarea\")\n                    .each((_, element) => {\n                        const name = $(element).attr(\"name\");\n                        if (name) {\n                            const newName = name.replace(\n                                /\\[\\d+\\]/,\n                                `[${index}]`\n                            );\n                            $(element).attr(\"name\", newName);\n                        }\n                        const id = $(element).attr(\"id\");\n                        if (id) {\n                            const newId = id.replace(/_\\d+_/, `_${index}_`);\n                            $(element).attr(\"id\", newId);\n                        }\n                    });\n            });\n        };\n\n        const updateTrashIcons = () => {\n            log.debug(\"updateTrashIcons\");\n            const partnerships = $(\"fieldset\");\n            if (partnerships.length > 1) {\n                $(\".local-equipment-remove-partnership\").show();\n            } else {\n                $(\".local-equipment-remove-partnership\").hide();\n            }\n        };\n\n        updatePartnershipNumbers();\n        updateHiddenFields();\n        updateTrashIcons();\n\n        $(document).on(\n            \"click\",\n            \".local-equipment-remove-partnership\",\n            function () {\n                log.debug(\"Event triggered\");\n                const $fieldset = $(this).closest(\"fieldset\");\n                // log.debug($fieldset);\n                // log.debug($fieldset.is(\":first-of-type\"));\n\n                // const isFirstPartnership =\n                //     $fieldset.is(\":first-of-type\");\n\n                // if (isFirstPartnership) {\n                //     Str.get_string(\n                //         \"cannotremovefirstpartnership\",\n                //         \"local_equipment\"\n                //     )\n                //         .then((string) => {\n                //             alert(string);\n                //         })\n                //         .catch((error) => {\n                //             log.error(\"Error getting string:\", error);\n                //         });\n                //     return;\n                // }\n\n                log.debug($fieldset);\n                const removedfieldset = $fieldset.remove();\n                log.debug(\"Fieldset removed\");\n                log.debug(\n                    \"Here's what returned from the '$fieldset.remove()' command:\",\n                    removedfieldset\n                );\n                updatePartnershipNumbers();\n                updateHiddenFields();\n                renumberFormElements();\n                updateTrashIcons();\n            }\n        );\n    });\n};\n"],"names":["debug","updatePartnershipNumbers","each","index","element","Str","get_string","then","string","text","catch","error","updateHiddenFields","partnershipsCount","length","val","url","URL","window","location","href","searchParams","set","history","replaceState","updateTrashIcons","show","hide","document","on","$fieldset","this","closest","removedfieldset","remove","fieldset","find","_","name","attr","newName","replace","id","newId"],"mappings":";;;;;;;;g0BA4BoB,0BACd,wBACMA,MAAM,6CAEJC,yBAA2B,yBAC3B,uCAAuCC,MAAK,CAACC,MAAOC,WAClDC,IAAIC,WAAW,cAAe,kBAAmBH,MAAQ,GACpDI,MAAMC,6BACDJ,SAASK,KAAKD,WAEnBE,OAAOC,qBACAA,MAAM,qCAAsCA,cAK1DC,mBAAqB,kBACnBZ,MAAM,4BACJa,mBAAoB,mBAAE,YAAYC,oBACpCd,qCAA8Ba,wCAChC,8BAA8BE,IAAIF,yBAG9BG,IAAM,IAAIC,IAAIC,OAAOC,SAASC,MACpCJ,IAAIK,aAAaC,IAAI,WAAYT,mBACjCK,OAAOK,QAAQC,aAAa,GAAI,GAAIR,MA2BlCS,iBAAmB,kBACjBzB,MAAM,qBACW,mBAAE,YACNc,OAAS,sBACpB,uCAAuCY,2BAEvC,uCAAuCC,QAIjD1B,2BACAW,qBACAa,uCAEEG,UAAUC,GACR,QACA,uCACA,wBACQ7B,MAAM,yBACJ8B,WAAY,mBAAEC,MAAMC,QAAQ,yBAqB9BhC,MAAM8B,iBACJG,gBAAkBH,UAAUI,sBAC9BlC,MAAM,iCACNA,MACA,8DACAiC,iBAEJhC,2BACAW,kCAvEAZ,MAAM,4CACR,YAAYE,MAAK,CAACC,MAAOgC,yBACnBnC,qCAA8BG,4BAChCgC,UACGC,KAAK,2BACLlC,MAAK,CAACmC,EAAGjC,iBACAkC,MAAO,mBAAElC,SAASmC,KAAK,WACzBD,KAAM,OACAE,QAAUF,KAAKG,QACjB,qBACItC,gCAENC,SAASmC,KAAK,OAAQC,eAEtBE,IAAK,mBAAEtC,SAASmC,KAAK,SACvBG,GAAI,OACEC,MAAQD,GAAGD,QAAQ,mBAAatC,gCACpCC,SAASmC,KAAK,KAAMI,cAwDlClB"}