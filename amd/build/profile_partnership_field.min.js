define("local_equipment/profile_partnership_field",["exports","jquery","core/ajax","core/notification","core/str"],(function(_exports,_jquery,_ajax,_notification,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Javascript for enhancing the partnership profile field with autocomplete.
   *
   * @module     local_equipment/profile_partnership_field
   * @copyright  2024 Your Name <your@email.com>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.init=async()=>{const $select=(0,_jquery.default)("#id_profile_field_partnership");if($select.length)try{const[searchPlaceholder,noPartnershipsFound]=await Promise.all([(0,_str.get_string)("searchpartnerships","local_equipment"),(0,_str.get_string)("nopartnershipsfound","local_equipment")]),$searchInput=(0,_jquery.default)("<input>",{type:"text",class:"form-control mb-2",placeholder:searchPlaceholder});$select.before($searchInput),$select.css("display","none");const $results=(0,_jquery.default)("<div>",{class:"list-group mt-1"});$searchInput.after($results);$select.val()&&$searchInput.val($select.find("option:selected").text());const fetchResults=async query=>{try{var _response$results;const response=await _ajax.default.call([{methodname:"local_equipment_get_partnerships",args:{query:query}}])[0];$results.empty(),null!==(_response$results=response.results)&&void 0!==_response$results&&_response$results.length?response.results.forEach((_ref=>{let{id:id,text:text}=_ref;const $item=(0,_jquery.default)("<a>",{href:"#",class:"list-group-item list-group-item-action",text:text,"data-value":id});$item.on("click",(e=>{e.preventDefault(),$select.val(id),$searchInput.val(text),$results.empty()})),$results.append($item)})):$results.append((0,_jquery.default)("<div>",{class:"list-group-item disabled",text:noPartnershipsFound}))}catch(error){_notification.default.exception(error)}};let searchTimeout;$searchInput.on("input",(e=>{const query=e.target.value;clearTimeout(searchTimeout),query.length<2?$results.empty():searchTimeout=setTimeout((()=>{fetchResults(query)}),300)})),(0,_jquery.default)(document).on("click",(e=>{(0,_jquery.default)(e.target).closest($searchInput.parent()).length||$results.empty()}))}catch(error){_notification.default.exception(error)}}}));

//# sourceMappingURL=profile_partnership_field.min.js.map