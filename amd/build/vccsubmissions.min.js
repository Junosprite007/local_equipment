define("local_equipment/vccsubmissions",["exports","jquery","core/ajax","core/notification","core/str"],(function(_exports,_jquery,_ajax,_notification,_str){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JavaScript for managing consents.
   *
   * @module     local_equipment/manage_consents
   * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initStudent=_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_ajax=_interopRequireDefault(_ajax),_notification=_interopRequireDefault(_notification);_exports.init=()=>{setupViewNotes(),setupAddNote()};_exports.initStudent=()=>{makeStudentSectionsCollapsible(),handleDeleteStudent(),handleAddStudent(),updateStudentNumbers()};const setupViewNotes=()=>{(0,_jquery.default)(".view-notes").on("click",(e=>{e.preventDefault();const consentId=(0,_jquery.default)(e.currentTarget).data("id");_ajax.default.call([{methodname:"local_equipment_get_consent_notes",args:{consentid:consentId},done:notes=>{(0,_jquery.default)("#note-modal .modal-body").html(notes),(0,_jquery.default)("#note-modal").modal("show")},fail:_notification.default.exception}])}))},setupAddNote=()=>{(0,_jquery.default)(".add-note").on("click",(e=>{e.preventDefault();const consentId=(0,_jquery.default)(e.currentTarget).data("id");(0,_jquery.default)("#note-modal .modal-body").html('<textarea id="admin-note" class="form-control" rows="5"></textarea>'),(0,_jquery.default)("#note-modal").modal("show"),(0,_jquery.default)("#save-note").off("click").on("click",(()=>{const note=(0,_jquery.default)("#admin-note").val();_ajax.default.call([{methodname:"local_equipment_add_consent_note",args:{consentid:consentId,note:note},done:()=>{(0,_jquery.default)("#note-modal").modal("hide"),(0,_str.get_string)("notesaved","local_equipment").then((s=>{_notification.default.addNotification({message:s,type:"success"})})).catch(_notification.default.exception)},fail:_notification.default.exception}])}))}))},makeStudentSectionsCollapsible=()=>{(0,_jquery.default)('fieldset[id^="id_studentheader_"]').each(((index,element)=>{(0,_jquery.default)(element).addClass("collapsible").addClass(0===index?"collapsed":"expanded"),(0,_jquery.default)(element).on("click",(()=>{(0,_jquery.default)(element).toggleClass("collapsed expanded")}))}))},handleDeleteStudent=()=>{(0,_jquery.default)(document).on("click",".local-equipment-remove-student",(e=>{e.preventDefault();(0,_jquery.default)(e.currentTarget).closest('fieldset[id^="id_studentheader_"]').remove(),updateStudentNumbers()}))},handleAddStudent=()=>{(0,_jquery.default)('input[name="add_student"]').on("click",(()=>{setTimeout(updateStudentNumbers,100)}))},updateStudentNumbers=()=>{(0,_jquery.default)('fieldset[id^="id_studentheader_"]').each(((index,element)=>{const legend=(0,_jquery.default)(element).find("legend");(0,_str.get_string)("student","local_equipment",index+1).then((str=>{legend.text(str)})).catch((error=>{console.error("Error updating student number:",error)}))}))}}));

//# sourceMappingURL=vccsubmissions.min.js.map