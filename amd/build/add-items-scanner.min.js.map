{"version":3,"file":"add-items-scanner.min.js","sources":["../src/add-items-scanner.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * Scanner integration for add items page.\n *\n * @module     local_equipment/add-items-scanner\n * @copyright  2024 onwards Joshua Kirby <josh@funlearningcompany.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport UniversalScanner from 'local_equipment/universal-scanner';\nimport Notification from 'core/notification';\nimport Log from 'core/log';\nimport jsQR from 'local_equipment/jsqr';\n\n/**\n * Initialize the scanner for add items page.\n */\nexport const init = () => {\n    Log.debug('local_equipment/add-items-scanner: init() called');\n    Log.debug(\n        'local_equipment/add-items-scanner: document.readyState =',\n        document.readyState\n    );\n\n    // Check if DOM is already ready\n    if (document.readyState === 'loading') {\n        // DOM is still loading, wait for DOMContentLoaded\n        Log.debug(\n            'local_equipment/add-items-scanner: DOM still loading, adding DOMContentLoaded listener'\n        );\n        document.addEventListener('DOMContentLoaded', function () {\n            Log.debug(\n                'local_equipment/add-items-scanner: DOMContentLoaded event fired'\n            );\n            initializeScanner();\n        });\n    } else {\n        // DOM is already ready, initialize immediately\n        Log.debug(\n            'local_equipment/add-items-scanner: DOM already ready, initializing immediately'\n        );\n        initializeScanner();\n    }\n};\n\n/**\n * Initialize the scanner interface.\n */\nfunction initializeScanner() {\n    Log.debug('local_equipment/add-items-scanner: initializeScanner() called');\n\n    const locationSelect = document.getElementById('location_select');\n    const manualUpc = document.getElementById('manual_upc');\n    const addItemBtn = document.getElementById('add_item_btn');\n    const sessionCount = document.getElementById('session_count');\n    const sessionItems = document.getElementById('session_items');\n    const printQrBtn = document.getElementById('print_qr_btn');\n    const scannerContainer = document.getElementById('scanner-container');\n\n    Log.debug('DOM elements found:', {\n        locationSelect: !!locationSelect,\n        manualUpc: !!manualUpc,\n        addItemBtn: !!addItemBtn,\n        sessionCount: !!sessionCount,\n        sessionItems: !!sessionItems,\n        printQrBtn: !!printQrBtn,\n        scannerContainer: !!scannerContainer,\n    });\n\n    let scanner = null;\n    let sessionItemCount = 0;\n    let sessionItemIds = [];\n\n    // Enable scanner when location is selected\n    locationSelect.addEventListener('change', function () {\n        if (this.value) {\n            // Initialize scanner\n            initScanner();\n\n            // Reset session when location changes\n            sessionItemCount = 0;\n            sessionItemIds = [];\n            updateSessionDisplay();\n\n            // Update product details panel\n            updateProductDetailsPanel(\n                'Location selected. Ready to scan UPC codes or enter them manually.'\n            );\n        } else {\n            // Clear scanner container\n            if (scannerContainer) {\n                scannerContainer.innerHTML = '';\n            }\n\n            // Destroy scanner\n            if (scanner) {\n                scanner.destroy();\n                scanner = null;\n            }\n\n            updateProductDetailsPanel(\n                'Please select a storage location first.'\n            );\n        }\n    });\n\n    /**\n     * Initialize the scanner interface.\n     */\n    function initScanner() {\n        if (!scannerContainer) {\n            Log.error('Scanner container not found in DOM');\n            return;\n        }\n\n        // Clear existing scanner interface\n        scannerContainer.innerHTML = '';\n\n        // Create scanner controls\n        const controlsDiv = document.createElement('div');\n        controlsDiv.className = 'scanner-controls';\n        controlsDiv.innerHTML = `\n            <div class=\"scanner-area mb-3\" id=\"scanner-area\">\n                <!-- Scanner video will be inserted here -->\n            </div>\n            <div class=\"scanner-toggle mb-3\">\n                <div class=\"btn-group\" role=\"group\">\n                    <button type=\"button\" id=\"start-camera-btn\" class=\"btn btn-primary\">\n                        <i class=\"fa fa-camera\"></i> Start Camera\n                    </button>\n                    <button type=\"button\" id=\"stop-camera-btn\" class=\"btn btn-secondary\" disabled>\n                        <i class=\"fa fa-stop\"></i> Stop Camera\n                    </button>\n                </div>\n                <div class=\"mt-2\">\n                    <button type=\"button\" id=\"scan-barcode-btn\" class=\"btn btn-primary\" style=\"display: none;\">\n                        <i class=\"fa fa-qrcode\"></i> Scan\n                    </button>\n                    <button type=\"button\" id=\"flip-camera-btn\" class=\"btn btn-outline-secondary btn-sm ms-2\" style=\"display: none;\"\n                        title=\"Toggle camera mirror\">\n                        <i class=\"fa fa-arrows-h\"></i> Flip\n                    </button>\n                </div>\n            </div>\n            <div class=\"file-upload-section mb-3\" style=\"display: none;\" id=\"file-upload-section\">\n                <label for=\"barcode-file-input\" class=\"form-label\">\n                    <i class=\"fa fa-camera\"></i> Take Photo of Barcode:\n                </label>\n                <div class=\"input-group\">\n                    <input type=\"file\" id=\"barcode-file-input\" class=\"form-control\" accept=\"image/*\" capture=\"environment\">\n                    <button type=\"button\" id=\"process-file-btn\" class=\"btn btn-outline-success\" disabled>\n                        <i class=\"fa fa-search\"></i> Scan Photo\n                    </button>\n                </div>\n                <small class=\"form-text text-muted\">\n                    Take a clear photo of the barcode with good lighting\n                </small>\n            </div>\n            <div class=\"manual-input\">\n                <label for=\"scanner-manual-input\" class=\"form-label\">Or enter barcode manually:</label>\n                <div class=\"input-group\">\n                    <input type=\"text\" id=\"scanner-manual-input\" class=\"form-control\" placeholder=\"Scan or type barcode...\">\n                    <button type=\"button\" id=\"scanner-manual-btn\" class=\"btn btn-outline-primary\">Process</button>\n                </div>\n            </div>\n        `;\n        scannerContainer.appendChild(controlsDiv);\n\n        // Initialize scanner instance\n        scanner = new UniversalScanner({\n            containerId: 'scanner-area',\n            resultCallback: handleScanResult,\n            errorCallback: handleScanError,\n        });\n\n        // Initialize scanner\n        scanner.init().then((success) => {\n            if (success) {\n                Log.debug('Scanner initialized successfully');\n            } else {\n                Log.error('Scanner initialization failed');\n                showFallbackInterface();\n            }\n        });\n\n        // Set up control buttons\n        setupScannerControls();\n\n        // Add network test button\n        addNetworkTestButton();\n    }\n\n    /**\n     * Set up scanner control buttons.\n     */\n    function setupScannerControls() {\n        const startBtn = document.getElementById('start-camera-btn');\n        const stopBtn = document.getElementById('stop-camera-btn');\n        const scanBtn = document.getElementById('scan-barcode-btn');\n        const flipBtn = document.getElementById('flip-camera-btn');\n        const manualInput = document.getElementById('scanner-manual-input');\n        const manualBtn = document.getElementById('scanner-manual-btn');\n\n        let isScanning = false;\n        let scanTimeout = null;\n        let isMirrored = false; // Default to mirrored (good for webcams)\n\n        startBtn.addEventListener('click', async () => {\n            try {\n                // Use robust camera detection\n                scanner.stream = await getCameraStreamRobust();\n\n                scanner.video.srcObject = scanner.stream;\n                await scanner.video.play();\n\n                // Set canvas dimensions to match video\n                scanner.canvas.width = scanner.video.videoWidth;\n                scanner.canvas.height = scanner.video.videoHeight;\n\n                scanner.updateStatus(\n                    'Camera ready - click Scan to detect barcode'\n                );\n\n                startBtn.disabled = true;\n                stopBtn.disabled = false;\n                scanBtn.style.display = 'inline-block';\n                flipBtn.style.display = 'inline-block';\n\n                // Apply initial mirror state\n                updateVideoMirror();\n\n                // Update product details panel\n                updateProductDetailsPanel(\n                    \"Camera started. Click 'Scan' to detect barcodes in the camera view.\"\n                );\n            } catch (error) {\n                Log.error('Failed to start camera:', error);\n\n                // Show detailed error information\n                const compatibility = await checkCameraCompatibility();\n                if (!compatibility.supported) {\n                    showDetailedCompatibilityError(compatibility);\n                } else {\n                    Notification.addNotification({\n                        message: 'Failed to start camera: ' + error.message,\n                        type: 'error',\n                    });\n                }\n            }\n        });\n\n        stopBtn.addEventListener('click', () => {\n            // Stop camera and hide scan button\n            if (scanner.stream) {\n                scanner.stream.getTracks().forEach((track) => track.stop());\n                scanner.stream = null;\n            }\n            if (scanner.video) {\n                scanner.video.srcObject = null;\n            }\n\n            scanner.updateStatus('Camera stopped');\n            startBtn.disabled = false;\n            stopBtn.disabled = true;\n            scanBtn.style.display = 'none';\n            flipBtn.style.display = 'none';\n\n            // Clear any active scanning\n            if (scanTimeout) {\n                clearTimeout(scanTimeout);\n                scanTimeout = null;\n            }\n            isScanning = false;\n        });\n\n        // Flip camera button - toggles horizontal mirror\n        flipBtn.addEventListener('click', () => {\n            isMirrored = !isMirrored;\n            updateVideoMirror();\n\n            // Update button text to show current state\n            const icon = isMirrored ? 'fa-arrows-h' : 'fa-arrows-h';\n            const text = isMirrored ? 'Flip (Mirrored)' : 'Flip (Normal)';\n            flipBtn.innerHTML = `<i class=\"fa ${icon}\"></i> ${text}`;\n\n            // Show feedback message\n            const message = isMirrored\n                ? 'Camera mirrored (good for webcams)'\n                : 'Camera normal (good for mobile)';\n            showSuccessMessage(message);\n        });\n\n        /**\n         * Update video mirror state based on isMirrored flag.\n         */\n        function updateVideoMirror() {\n            // Find the video element in the scanner area\n            const videoElement = document.querySelector('#scanner-area video');\n\n            if (videoElement) {\n                // Apply transform directly via inline style (more reliable)\n                if (isMirrored) {\n                    videoElement.style.transform = 'scaleX(-1)';\n                } else {\n                    videoElement.style.transform = 'scaleX(1)';\n                }\n\n                Log.debug(\n                    'Video mirror updated:',\n                    isMirrored ? 'mirrored (scaleX(-1))' : 'normal (scaleX(1))',\n                    'Video element found:',\n                    !!videoElement,\n                    'Applied transform:',\n                    videoElement.style.transform\n                );\n            } else {\n                Log.error('Video element not found for mirror update');\n            }\n        }\n\n        // Scan button - triggers 1-second scan window\n        scanBtn.addEventListener('click', async () => {\n            if (isScanning) {\n                return;\n            }\n\n            isScanning = true;\n            scanBtn.disabled = true;\n            scanBtn.innerHTML =\n                '<i class=\"fa fa-spinner fa-spin\"></i> Scanning...';\n            scanner.updateStatus('Scanning for barcode...');\n\n            try {\n                const result = await performSingleScan();\n                if (result) {\n                    // Barcode found and processed\n                    scanner.updateStatus('Scan successful!');\n                    scanner.showScanSuccess();\n                } else {\n                    // No barcode found\n                    scanner.updateStatus('No barcode detected - try again');\n                    showErrorMessage(\n                        'No barcode detected. Please position the barcode in the target area and try again.'\n                    );\n                }\n            } catch (error) {\n                Log.error('Scan error:', error);\n                scanner.updateStatus('Scan failed');\n                showErrorMessage('Scan failed. Please try again.');\n            }\n\n            // Reset button state\n            isScanning = false;\n            scanBtn.disabled = false;\n            scanBtn.innerHTML = '<i class=\"fa fa-qrcode\"></i> Scan';\n\n            // Reset status after a delay\n            setTimeout(() => {\n                scanner.updateStatus(\n                    'Ready to scan - position barcode and click Scan'\n                );\n            }, 2000);\n        });\n\n        /**\n         * Perform a single 1-second scan attempt.\n         * @returns {Promise<boolean>} True if barcode was found and processed\n         */\n        async function performSingleScan() {\n            return new Promise((resolve) => {\n                let scanAttempts = 0;\n                const maxAttempts = 30; // ~1 second at 30fps\n                let found = false;\n\n                const scanFrame = async () => {\n                    if (found || scanAttempts >= maxAttempts) {\n                        resolve(found);\n                        return;\n                    }\n\n                    try {\n                        // Check if video is ready\n                        if (\n                            !scanner.video ||\n                            scanner.video.readyState !==\n                                scanner.video.HAVE_ENOUGH_DATA\n                        ) {\n                            scanAttempts++;\n                            requestAnimationFrame(scanFrame);\n                            return;\n                        }\n\n                        // Draw current frame to canvas\n                        scanner.context.drawImage(\n                            scanner.video,\n                            0,\n                            0,\n                            scanner.canvas.width,\n                            scanner.canvas.height\n                        );\n\n                        // Try native BarcodeDetector first (Chrome/Edge)\n                        if (scanner.hasBarcodeDetector) {\n                            try {\n                                // eslint-disable-next-line no-undef\n                                const detector = new BarcodeDetector({\n                                    formats: [\n                                        'qr_code',\n                                        'ean_13',\n                                        'ean_8',\n                                        'upc_a',\n                                        'upc_e',\n                                        'code_128',\n                                        'code_39',\n                                    ],\n                                });\n\n                                const barcodes = await detector.detect(\n                                    scanner.canvas\n                                );\n\n                                if (barcodes.length > 0) {\n                                    const barcode = barcodes[0];\n                                    Log.debug(\n                                        'Barcode detected:',\n                                        barcode.rawValue,\n                                        barcode.format\n                                    );\n                                    processBarcode(barcode.rawValue);\n                                    found = true;\n                                    resolve(true);\n                                    return;\n                                }\n                            } catch (error) {\n                                Log.debug('BarcodeDetector failed:', error);\n                            }\n                        }\n\n                        // Fallback: Try QR code detection\n                        try {\n                            const imageData = scanner.context.getImageData(\n                                0,\n                                0,\n                                scanner.canvas.width,\n                                scanner.canvas.height\n                            );\n\n                            // Use jsQR library for QR code detection\n                            const code = jsQR.scan(\n                                imageData.data,\n                                imageData.width,\n                                imageData.height\n                            );\n\n                            if (code && code.data) {\n                                Log.debug('QR code detected:', code.data);\n                                processBarcode(code.data);\n                                found = true;\n                                resolve(true);\n                                return;\n                            }\n                        } catch (error) {\n                            Log.debug('QR detection failed:', error);\n                        }\n                    } catch (error) {\n                        Log.debug('Frame processing error:', error);\n                    }\n\n                    scanAttempts++;\n                    requestAnimationFrame(scanFrame);\n                };\n\n                // Start scanning\n                requestAnimationFrame(scanFrame);\n            });\n        }\n\n        // Manual input handling\n        manualBtn.addEventListener('click', () => {\n            const barcode = manualInput.value.trim();\n            if (barcode) {\n                processBarcode(barcode);\n                manualInput.value = '';\n            }\n        });\n\n        manualInput.addEventListener('keypress', (e) => {\n            if (e.key === 'Enter') {\n                manualBtn.click();\n            }\n        });\n    }\n\n    /**\n     * Handle scan result from scanner.\n     *\n     * @param {Object} result Scan result\n     */\n    function handleScanResult(result) {\n        if (result.success && result.data) {\n            // Extract barcode data from the scan result\n            const barcodeData = result.data.barcode_data || result.data;\n            Log.debug('Scan successful, processing barcode:', barcodeData);\n            processBarcode(barcodeData);\n        } else {\n            Log.error('Scan failed:', result);\n            // Show error message to user\n            const errorMsg = result.message || 'Scan failed. Please try again.';\n            showErrorMessage(errorMsg);\n        }\n    }\n\n    /**\n     * Handle scan error from scanner.\n     *\n     * @param {string} errorCode Error code\n     * @param {string} message Error message\n     */\n    function handleScanError(errorCode, message) {\n        Log.error('Scanner error:', errorCode, message);\n\n        if (errorCode === 'camera_access_failed') {\n            showFallbackInterface();\n        }\n    }\n\n    /**\n     * Show fallback interface when camera is not available.\n     */\n    function showFallbackInterface() {\n        if (scannerContainer) {\n            const isMobile =\n                /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n                    navigator.userAgent\n                );\n            const isHTTP = window.location.protocol === 'http:';\n\n            let content = '';\n\n            if (isMobile && isHTTP) {\n                // Mobile + HTTP specific guidance\n                content = `\n                    <div class=\"alert alert-info\">\n                        <h5><i class=\"fa fa-mobile\"></i> Mobile Camera Setup Required</h5>\n                        <p><strong>To enable camera scanning on mobile:</strong></p>\n                        <ol class=\"text-start mb-3\">\n                            <li>Open Chrome menu (⋮) → <strong>Settings</strong></li>\n                            <li>Go to <strong>Site Settings</strong> → <strong>Camera</strong></li>\n                            <li>Find this site and set to <strong>\"Allow\"</strong></li>\n                        </ol>\n                        <p><strong>Alternative:</strong> In Chrome address bar, type:<br>\n                        <code>chrome://flags/#unsafely-treat-insecure-origin-as-secure</code><br>\n                        Add: <code>${window.location.origin}</code></p>\n                        <button type=\"button\" id=\"test-camera-btn\" class=\"btn btn-primary btn-sm mt-2\">\n                            <i class=\"fa fa-camera\"></i> Test Camera Access\n                        </button>\n                    </div>\n                `;\n            } else if (isMobile) {\n                // Mobile + HTTPS\n                content = `\n                    <div class=\"alert alert-warning text-center\">\n                        <i class=\"fa fa-mobile\"></i>\n                        <strong>Camera access denied</strong><br>\n                        Please check your browser settings and allow camera access for this site.\n                        <button type=\"button\" id=\"test-camera-btn\" class=\"btn btn-primary btn-sm mt-2\">\n                            <i class=\"fa fa-camera\"></i> Test Camera Access\n                        </button>\n                    </div>\n                `;\n            } else {\n                // Desktop fallback\n                content = `\n                    <div class=\"alert alert-warning text-center\">\n                        <i class=\"fa fa-exclamation-triangle\"></i>\n                        <strong>Camera not available</strong><br>\n                        Please use the manual input below to enter barcodes.\n                    </div>\n                `;\n            }\n\n            scannerContainer.innerHTML = content;\n\n            // Add test camera button functionality\n            const testBtn = document.getElementById('test-camera-btn');\n            if (testBtn) {\n                testBtn.addEventListener('click', testCameraAccess);\n            }\n\n            // Show file upload option for mobile users\n            if (isMobile) {\n                const fileUploadSection = document.getElementById(\n                    'file-upload-section'\n                );\n                if (fileUploadSection) {\n                    fileUploadSection.style.display = 'block';\n                    setupFileUpload();\n                }\n            }\n        }\n    }\n\n    /**\n     * Set up file upload functionality for mobile users.\n     */\n    function setupFileUpload() {\n        const fileInput = document.getElementById('barcode-file-input');\n        const processFileBtn = document.getElementById('process-file-btn');\n\n        if (!fileInput || !processFileBtn) {\n            return;\n        }\n\n        // Enable process button when file is selected\n        fileInput.addEventListener('change', function () {\n            processFileBtn.disabled = !this.files.length;\n        });\n\n        // Process uploaded file\n        processFileBtn.addEventListener('click', async function () {\n            const file = fileInput.files[0];\n            if (!file) {\n                return;\n            }\n\n            const originalText = this.innerHTML;\n            this.disabled = true;\n            this.innerHTML =\n                '<i class=\"fa fa-spinner fa-spin\"></i> Scanning Photo...';\n\n            try {\n                const barcode = await processImageFile(file);\n                if (barcode) {\n                    showSuccessMessage('Barcode detected from photo!');\n                    processBarcode(barcode);\n                    // Clear the file input\n                    fileInput.value = '';\n                } else {\n                    showErrorMessage(\n                        'No barcode found in the image. Please try taking a clearer photo with better lighting.'\n                    );\n                }\n            } catch (error) {\n                Log.error('File processing error:', error);\n                showErrorMessage('Failed to process image. Please try again.');\n            }\n\n            this.disabled = false;\n            this.innerHTML = originalText;\n            processFileBtn.disabled = true; // Disable until new file selected\n        });\n    }\n\n    /**\n     * Process an uploaded image file for barcodes.\n     * @param {File} file Image file\n     * @returns {Promise<string|null>} Detected barcode or null\n     */\n    async function processImageFile(file) {\n        return new Promise((resolve, reject) => {\n            const reader = new FileReader();\n\n            reader.onload = function (e) {\n                const img = new Image();\n\n                img.onload = async function () {\n                    try {\n                        // Create a temporary canvas for processing\n                        const canvas = document.createElement('canvas');\n                        const context = canvas.getContext('2d', {\n                            willReadFrequently: true,\n                        });\n\n                        // Set canvas size to image size\n                        canvas.width = img.width;\n                        canvas.height = img.height;\n\n                        // Draw image to canvas\n                        context.drawImage(img, 0, 0);\n\n                        // Try native BarcodeDetector first (Chrome/Edge)\n                        if ('BarcodeDetector' in window) {\n                            try {\n                                // eslint-disable-next-line no-undef\n                                const detector = new BarcodeDetector({\n                                    formats: [\n                                        'qr_code',\n                                        'ean_13',\n                                        'ean_8',\n                                        'upc_a',\n                                        'upc_e',\n                                        'code_128',\n                                        'code_39',\n                                    ],\n                                });\n\n                                const barcodes = await detector.detect(canvas);\n\n                                if (barcodes.length > 0) {\n                                    Log.debug(\n                                        'Barcode detected from file:',\n                                        barcodes[0].rawValue\n                                    );\n                                    resolve(barcodes[0].rawValue);\n                                    return;\n                                }\n                            } catch (error) {\n                                Log.debug(\n                                    'BarcodeDetector failed on file:',\n                                    error\n                                );\n                            }\n                        }\n\n                        // Fallback: Try QR code detection with jsQR\n                        try {\n                            const imageData = context.getImageData(\n                                0,\n                                0,\n                                canvas.width,\n                                canvas.height\n                            );\n                            const code = jsQR.scan(\n                                imageData.data,\n                                imageData.width,\n                                imageData.height\n                            );\n\n                            if (code && code.data) {\n                                Log.debug(\n                                    'QR code detected from file:',\n                                    code.data\n                                );\n                                resolve(code.data);\n                                return;\n                            }\n                        } catch (error) {\n                            Log.debug('jsQR failed on file:', error);\n                        }\n\n                        // No barcode found\n                        resolve(null);\n                    } catch (error) {\n                        reject(error);\n                    }\n                };\n\n                img.onerror = function () {\n                    reject(new Error('Failed to load image'));\n                };\n\n                img.src = e.target.result;\n            };\n\n            reader.onerror = function () {\n                reject(new Error('Failed to read file'));\n            };\n\n            reader.readAsDataURL(file);\n        });\n    }\n\n    /**\n     * Test camera access with comprehensive compatibility checking.\n     */\n    async function testCameraAccess() {\n        const testBtn = document.getElementById('test-camera-btn');\n        const originalText = testBtn.innerHTML;\n\n        testBtn.disabled = true;\n        testBtn.innerHTML = '<i class=\"fa fa-spinner fa-spin\"></i> Testing...';\n\n        // First, run comprehensive compatibility check\n        const compatibility = await checkCameraCompatibility();\n\n        if (!compatibility.supported) {\n            showDetailedCompatibilityError(compatibility);\n            testBtn.disabled = false;\n            testBtn.innerHTML = originalText;\n            return;\n        }\n\n        // Try to access camera using the best available method\n        try {\n            const stream = await getCameraStreamRobust();\n\n            // Success! Camera access granted\n            stream.getTracks().forEach((track) => track.stop());\n\n            showSuccessMessage(\n                'Camera access granted! You can now use the Start Camera button.'\n            );\n\n            // Re-initialize scanner interface\n            initScanner();\n        } catch (error) {\n            // Provide specific error guidance\n            let errorMessage = 'Camera access failed. ';\n\n            if (error.name === 'NotAllowedError') {\n                errorMessage +=\n                    'Please allow camera permissions in your browser settings.';\n            } else if (error.name === 'NotFoundError') {\n                errorMessage += 'No camera found on this device.';\n            } else if (error.name === 'NotSupportedError') {\n                errorMessage += 'Camera not supported on this browser/device.';\n            } else if (error.name === 'NotReadableError') {\n                errorMessage += 'Camera is being used by another application.';\n            } else {\n                errorMessage += `Error: ${error.message}`;\n            }\n\n            showErrorMessage(errorMessage);\n\n            testBtn.disabled = false;\n            testBtn.innerHTML = originalText;\n        }\n    }\n\n    /**\n     * Comprehensive camera compatibility check.\n     * @returns {Promise<Object>} Compatibility information\n     */\n    async function checkCameraCompatibility() {\n        const result = {\n            supported: false,\n            method: null,\n            issues: [],\n            browserInfo: getBrowserInfo(),\n            apis: {\n                mediaDevices: false,\n                getUserMedia: false,\n                webkitGetUserMedia: false,\n                mozGetUserMedia: false,\n            },\n        };\n\n        Log.debug('Browser info:', result.browserInfo);\n\n        // Check for modern MediaDevices API\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n            result.apis.mediaDevices = true;\n            result.method = 'mediaDevices';\n            result.supported = true;\n        }\n\n        // Check for legacy getUserMedia\n        if (navigator.getUserMedia) {\n            result.apis.getUserMedia = true;\n            if (!result.supported) {\n                result.method = 'getUserMedia';\n                result.supported = true;\n            }\n        }\n\n        // Check for webkit prefixed version (older Chrome/Safari)\n        if (navigator.webkitGetUserMedia) {\n            result.apis.webkitGetUserMedia = true;\n            if (!result.supported) {\n                result.method = 'webkitGetUserMedia';\n                result.supported = true;\n            }\n        }\n\n        // Check for moz prefixed version (older Firefox)\n        if (navigator.mozGetUserMedia) {\n            result.apis.mozGetUserMedia = true;\n            if (!result.supported) {\n                result.method = 'mozGetUserMedia';\n                result.supported = true;\n            }\n        }\n\n        // Check for HTTPS/secure context\n        if (\n            location.protocol !== 'https:' &&\n            location.hostname !== 'localhost'\n        ) {\n            result.issues.push('insecure_context');\n        }\n\n        // Check if we're in a mobile browser\n        if (result.browserInfo.mobile && !result.supported) {\n            result.issues.push('mobile_no_camera_api');\n        }\n\n        Log.debug('Camera compatibility check:', result);\n        return result;\n    }\n\n    /**\n     * Get detailed browser information.\n     * @returns {Object} Browser information\n     */\n    function getBrowserInfo() {\n        const ua = navigator.userAgent;\n        const result = {\n            mobile: /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n                ua\n            ),\n            chrome: /Chrome/i.test(ua),\n            firefox: /Firefox/i.test(ua),\n            safari: /Safari/i.test(ua) && !/Chrome/i.test(ua),\n            edge: /Edge/i.test(ua),\n            version: null,\n            android: /Android/i.test(ua),\n            ios: /iPhone|iPad|iPod/i.test(ua),\n        };\n\n        // Extract Chrome version\n        if (result.chrome) {\n            const match = ua.match(/Chrome\\/(\\d+)/);\n            if (match) {\n                result.version = parseInt(match[1]);\n            }\n        }\n\n        return result;\n    }\n\n    /**\n     * Robust camera stream acquisition with fallbacks.\n     * @returns {Promise<MediaStream>} Camera stream\n     */\n    async function getCameraStreamRobust() {\n        const constraints = {\n            video: {\n                facingMode: 'environment',\n                width: { ideal: 1280 },\n                height: { ideal: 720 },\n            },\n        };\n\n        // Try modern API first\n        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {\n            try {\n                Log.debug('Trying modern mediaDevices.getUserMedia');\n                return await navigator.mediaDevices.getUserMedia(constraints);\n            } catch (error) {\n                Log.debug('Modern API failed:', error);\n                // Continue to fallbacks\n            }\n        }\n\n        // Try legacy getUserMedia with Promise wrapper\n        if (navigator.getUserMedia) {\n            try {\n                Log.debug('Trying legacy getUserMedia');\n                return await new Promise((resolve, reject) => {\n                    navigator.getUserMedia(constraints, resolve, reject);\n                });\n            } catch (error) {\n                Log.debug('Legacy getUserMedia failed:', error);\n            }\n        }\n\n        // Try webkit prefixed version\n        if (navigator.webkitGetUserMedia) {\n            try {\n                Log.debug('Trying webkitGetUserMedia');\n                return await new Promise((resolve, reject) => {\n                    navigator.webkitGetUserMedia(constraints, resolve, reject);\n                });\n            } catch (error) {\n                Log.debug('webkitGetUserMedia failed:', error);\n            }\n        }\n\n        // Try moz prefixed version\n        if (navigator.mozGetUserMedia) {\n            try {\n                Log.debug('Trying mozGetUserMedia');\n                return await new Promise((resolve, reject) => {\n                    navigator.mozGetUserMedia(constraints, resolve, reject);\n                });\n            } catch (error) {\n                Log.debug('mozGetUserMedia failed:', error);\n            }\n        }\n\n        throw new Error('No camera API available');\n    }\n\n    /**\n     * Show detailed compatibility error with specific guidance.\n     * @param {Object} compatibility Compatibility check result\n     */\n    function showDetailedCompatibilityError(compatibility) {\n        let message =\n            '<div class=\"alert alert-danger\"><h5><i class=\"fa fa-exclamation-triangle\"></i> Camera Not Supported</h5>';\n\n        message +=\n            '<p><strong>Browser:</strong> ' + compatibility.browserInfo.chrome\n                ? `Chrome ${compatibility.browserInfo.version || 'Unknown'}`\n                : 'Unknown browser';\n\n        message +=\n            '<br><strong>Mobile:</strong> ' +\n            (compatibility.browserInfo.mobile ? 'Yes' : 'No');\n        message +=\n            '<br><strong>Secure Context:</strong> ' +\n            (location.protocol === 'https:' ? 'Yes' : 'No') +\n            '</p>';\n\n        message += '<p><strong>Available APIs:</strong></p><ul>';\n        Object.keys(compatibility.apis).forEach((api) => {\n            message += `<li>${api}: ${\n                compatibility.apis[api] ? '✓' : '✗'\n            }</li>`;\n        });\n        message += '</ul>';\n\n        if (compatibility.issues.length > 0) {\n            message += '<p><strong>Issues Found:</strong></p><ul>';\n            compatibility.issues.forEach((issue) => {\n                switch (issue) {\n                    case 'insecure_context':\n                        message +=\n                            '<li>Site is not served over HTTPS (required for camera access)</li>';\n                        break;\n                    case 'mobile_no_camera_api':\n                        message +=\n                            '<li>Mobile browser does not support camera API</li>';\n                        break;\n                }\n            });\n            message += '</ul>';\n        }\n\n        // Specific guidance based on browser\n        if (\n            compatibility.browserInfo.chrome &&\n            compatibility.browserInfo.mobile\n        ) {\n            message +=\n                '<div class=\"mt-3\"><strong>Chrome Mobile Solutions:</strong>';\n            message += '<ol>';\n            message += '<li>Ensure Chrome is updated to latest version</li>';\n            message += '<li>Try clearing Chrome cache and data</li>';\n            message +=\n                '<li>Check if \"Use camera\" is enabled in Chrome settings</li>';\n            message += '<li>Try accessing via Chrome Incognito mode</li>';\n            message += '</ol></div>';\n        }\n\n        message += '</div>';\n\n        if (scannerContainer) {\n            scannerContainer.innerHTML = message;\n        }\n    }\n\n    /**\n     * Normalize UPC code to standard 12-digit format (client-side).\n     * @param {string} upc Raw UPC code\n     * @returns {string|null} Normalized UPC or null if invalid\n     */\n    function normalizeUPC(upc) {\n        // Remove any non-numeric characters\n        upc = upc.replace(/[^0-9]/g, '');\n\n        // Check if it's a valid length (8-14 digits)\n        const length = upc.length;\n        if (length < 8 || length > 14) {\n            return null;\n        }\n\n        // Handle different UPC formats\n        switch (length) {\n            case 8:\n                // UPC-E format - pad to 12 digits\n                return upc.padStart(12, '0');\n\n            case 12:\n                // UPC-A format - this is our target format\n                return upc;\n\n            case 13:\n                // EAN-13 format - remove leading zero if it's 0\n                if (upc.charAt(0) === '0') {\n                    return upc.substring(1);\n                }\n                // Non-US EAN code - keep as-is\n                return upc;\n\n            case 14:\n                // GTIN-14 format - remove leading zeros\n                return upc.replace(/^0+/, '');\n\n            default:\n                // 9, 10, 11 digits - pad to 12\n                return upc.padStart(12, '0');\n        }\n    }\n\n    /**\n     * Process a barcode (from scan or manual entry).\n     *\n     * @param {string} barcode Barcode data\n     */\n    function processBarcode(barcode) {\n        const locationId = locationSelect.value;\n        if (!locationId) {\n            Notification.addNotification({\n                message: 'Please select a location first',\n                type: 'error',\n            });\n            return;\n        }\n\n        // Normalize UPC on client side for immediate feedback\n        const originalBarcode = barcode;\n        const normalizedBarcode = normalizeUPC(barcode);\n\n        if (!normalizedBarcode) {\n            showErrorMessage(\n                `Invalid UPC format: \"${originalBarcode}\". UPC must be 8-14 digits.`\n            );\n            return;\n        }\n\n        // Log normalization for debugging\n        if (originalBarcode !== normalizedBarcode) {\n            Log.debug(\n                `UPC normalized: \"${originalBarcode}\" -> \"${normalizedBarcode}\"`\n            );\n            showSuccessMessage(\n                `UPC normalized: ${originalBarcode} → ${normalizedBarcode}`\n            );\n        }\n\n        // Show processing state\n        const processingBtn = document.getElementById('scanner-manual-btn');\n        if (processingBtn) {\n            processingBtn.disabled = true;\n            processingBtn.textContent = 'Processing...';\n        }\n\n        // Process via existing UPC validation endpoint\n        processUPC(normalizedBarcode, locationId).finally(() => {\n            // Reset button state\n            if (processingBtn) {\n                processingBtn.disabled = false;\n                processingBtn.textContent = 'Process';\n            }\n        });\n    }\n\n    /**\n     * Process UPC using existing validation endpoint.\n     *\n     * @param {string} upc UPC code\n     * @param {string} locationId Location ID\n     * @returns {Promise} Processing promise\n     */\n    async function processUPC(upc, locationId) {\n        // Validate session key\n        if (!window.M || !window.M.cfg || !window.M.cfg.sesskey) {\n            showErrorMessage(\n                'Session expired. Please refresh the page and log in again.'\n            );\n            return;\n        }\n\n        const requestUrl =\n            M.cfg.wwwroot +\n            '/local/equipment/classes/external/validate_upc.php';\n        const requestData = {\n            upc: upc,\n            locationid: locationId,\n            sesskey: M.cfg.sesskey,\n        };\n\n        Log.debug('Processing UPC request:', {\n            url: requestUrl,\n            data: requestData,\n            wwwroot: M.cfg.wwwroot,\n            currentOrigin: window.location.origin,\n            currentHost: window.location.host,\n        });\n\n        try {\n            const response = await fetch(requestUrl, {\n                method: 'POST',\n                headers: {\n                    'Content-Type': 'application/json',\n                    Accept: 'application/json',\n                },\n                body: JSON.stringify(requestData),\n            });\n\n            Log.debug('Response received:', {\n                status: response.status,\n                statusText: response.statusText,\n                ok: response.ok,\n                headers: Object.fromEntries(response.headers.entries()),\n            });\n\n            if (!response.ok) {\n                throw new Error(\n                    `HTTP ${response.status}: ${response.statusText}`\n                );\n            }\n\n            const contentType = response.headers.get('content-type');\n            if (!contentType || !contentType.includes('application/json')) {\n                const textResponse = await response.text();\n                Log.error('Non-JSON response received:', textResponse);\n                throw new Error(\n                    `Expected JSON response, got: ${contentType}. Response: ${textResponse.substring(\n                        0,\n                        200\n                    )}`\n                );\n            }\n\n            const data = await response.json();\n            Log.debug('Parsed response data:', data);\n\n            if (data.success) {\n                // Item added successfully\n                sessionItemCount++;\n                sessionItemIds.push(data.itemid);\n                updateSessionDisplay();\n                showSuccessMessage(data.product_name);\n            } else {\n                // Error occurred\n                showErrorMessage(data.message, data.product_url);\n            }\n        } catch (error) {\n            Log.error('Error processing UPC:', {\n                error: error.message,\n                stack: error.stack,\n                upc: upc,\n                locationId: locationId,\n                requestUrl: requestUrl,\n            });\n\n            // Show detailed error message\n            let errorMessage = 'Network error occurred. ';\n\n            if (error.name === 'TypeError' && error.message.includes('fetch')) {\n                errorMessage +=\n                    'Unable to connect to server. Check your network connection.';\n            } else if (error.message.includes('HTTP')) {\n                errorMessage += `Server error: ${error.message}`;\n            } else if (error.message.includes('JSON')) {\n                errorMessage += 'Server returned invalid response format.';\n            } else {\n                errorMessage += `Details: ${error.message}`;\n            }\n\n            showErrorMessage(errorMessage);\n        }\n    }\n\n    /**\n     * Update session display.\n     */\n    function updateSessionDisplay() {\n        sessionCount.textContent = sessionItemCount;\n        if (sessionItemCount > 0) {\n            printQrBtn.style.display = 'inline-block';\n        } else {\n            printQrBtn.style.display = 'none';\n        }\n    }\n\n    /**\n     * Show success message.\n     *\n     * @param {string} productName Product name\n     */\n    function showSuccessMessage(productName) {\n        const alert = document.createElement('div');\n        alert.className =\n            'alert alert-success alert-dismissible fade show mt-2';\n        alert.innerHTML = `\n            <strong>✓ Success!</strong> Added ${productName} to inventory.\n            <button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>\n        `;\n        sessionItems.appendChild(alert);\n\n        // Auto-dismiss after 3 seconds\n        setTimeout(() => {\n            if (alert.parentNode) {\n                alert.remove();\n            }\n        }, 3000);\n    }\n\n    /**\n     * Show error message.\n     *\n     * @param {string} message Error message\n     * @param {string} productUrl Product URL (optional)\n     */\n    function showErrorMessage(message, productUrl = null) {\n        const alert = document.createElement('div');\n        alert.className = 'alert alert-danger alert-dismissible fade show mt-2';\n        let content = `<strong>✗ Error:</strong> ${message}`;\n        if (productUrl) {\n            content += ` <a href=\"${productUrl}\" class=\"alert-link\">Add this product type</a>`;\n        }\n        content += `<button type=\"button\" class=\"btn-close\" data-bs-dismiss=\"alert\"></button>`;\n        alert.innerHTML = content;\n        sessionItems.appendChild(alert);\n    }\n\n    /**\n     * Test network connectivity to the server.\n     * @returns {Promise<boolean>} True if connectivity is working\n     */\n    async function testNetworkConnectivity() {\n        try {\n            const testUrl =\n                M.cfg.wwwroot +\n                '/local/equipment/classes/external/validate_upc.php';\n\n            Log.debug('Testing network connectivity to:', testUrl);\n\n            // Send a simple OPTIONS request to test connectivity\n            const response = await fetch(testUrl, {\n                method: 'OPTIONS',\n                headers: {\n                    Accept: 'application/json',\n                },\n            });\n\n            Log.debug('Network test response:', {\n                status: response.status,\n                ok: response.ok,\n                headers: Object.fromEntries(response.headers.entries()),\n            });\n\n            return response.ok;\n        } catch (error) {\n            Log.error('Network connectivity test failed:', error);\n            return false;\n        }\n    }\n\n    /**\n     * Adds a network test button to the scanner controls interface.\n     *\n     * Creates and appends a network test button to the existing scanner controls container.\n     * The button includes a click handler that performs an asynchronous network connectivity\n     * test with visual feedback (loading spinner) and displays success/error messages.\n     *\n     * @function addNetworkTestButton\n     * @returns {void} This function does not return a value\n     *\n     * @requires testNetworkConnectivity - Async function that tests network connectivity\n     * @requires showSuccessMessage - Function to display success notifications\n     * @requires showErrorMessage - Function to display error notifications\n     *\n     * @example\n     * // Call after DOM is loaded to add the network test button\n     * addNetworkTestButton();\n     *\n     * @since 1.0.0\n     *\n     * @description\n     * - Searches for an element with class 'scanner-controls'\n     * - Only creates button if container exists and button doesn't already exist\n     * - Button shows WiFi icon and \"Test Network\" text\n     * - During testing, button is disabled and shows spinner with \"Testing...\" text\n     * - Results are communicated via success/error message functions\n     * - Button is re-enabled after test completion regardless of result\n     *\n     * @sideeffects\n     * - Modifies the DOM by appending a button element\n     * - May display success/error messages to the user\n     */\n    function addNetworkTestButton() {\n        const scannerControls = document.querySelector('.scanner-controls');\n        if (scannerControls && !document.getElementById('test-network-btn')) {\n            const testButton = document.createElement('button');\n            testButton.id = 'test-network-btn';\n            testButton.type = 'button';\n            testButton.className = 'btn btn-outline-info btn-sm mt-2';\n            testButton.innerHTML = '<i class=\"fa fa-wifi\"></i> Test Network';\n\n            testButton.addEventListener('click', async function () {\n                const originalText = this.innerHTML;\n                this.disabled = true;\n                this.innerHTML =\n                    '<i class=\"fa fa-spinner fa-spin\"></i> Testing...';\n\n                const isConnected = await testNetworkConnectivity();\n\n                if (isConnected) {\n                    showSuccessMessage('Network connectivity test passed!');\n                } else {\n                    showErrorMessage(\n                        'Network connectivity test failed. Check your connection.'\n                    );\n                }\n\n                this.disabled = false;\n                this.innerHTML = originalText;\n            });\n\n            scannerControls.appendChild(testButton);\n        }\n    }\n\n    /**\n     * Update product details panel with status information.\n     * @param {string} message Status message to display\n     * @param {string} alertType Bootstrap alert type (info, success, warning, danger)\n     */\n    function updateProductDetailsPanel(message, alertType = 'info') {\n        const productDetails = document.getElementById('product-details');\n        if (!productDetails) {\n            Log.debug('Product details panel not found');\n            return;\n        }\n\n        const alertClass = `alert alert-${alertType}`;\n        productDetails.innerHTML = `\n            <div class=\"${alertClass}\">\n                <i class=\"fa fa-info-circle me-2\"></i>\n                ${message}\n            </div>\n            <h5 class=\"mt-3\">How to Add Items:</h5>\n            <ol>\n                <li>Select the storage location where items will be placed</li>\n                <li>Scan the UPC barcode on each item's packaging</li>\n                <li>Each scan will automatically add one item to inventory</li>\n                <li>Continue scanning until all items are added</li>\n            </ol>\n            <p class=\"mb-0\">\n                <strong>Note: </strong>\n                If you scan a UPC that isn't in the system, you'll be prompted to add it as a new product type first.\n            </p>\n        `;\n    }\n\n    // Handle existing manual UPC input\n    if (addItemBtn) {\n        addItemBtn.addEventListener('click', function () {\n            const upc = manualUpc.value.trim();\n            if (upc) {\n                processBarcode(upc);\n                manualUpc.value = '';\n            }\n        });\n    }\n\n    // Allow Enter key in existing UPC input\n    if (manualUpc) {\n        manualUpc.addEventListener('keypress', function (e) {\n            if (e.key === 'Enter') {\n                addItemBtn.click();\n            }\n        });\n    }\n\n    // Handle print QR codes button\n    if (printQrBtn) {\n        printQrBtn.addEventListener('click', function () {\n            if (sessionItemIds.length > 0) {\n                const url =\n                    M.cfg.wwwroot +\n                    '/local/equipment/inventory/generate_qr.php';\n                const params = new URLSearchParams({\n                    action: 'generate_for_items',\n                    itemids: sessionItemIds.join(','),\n                    sesskey: M.cfg.sesskey,\n                });\n                window.open(url + '?' + params.toString(), '_blank');\n            }\n        });\n    }\n}\n"],"names":["initializeScanner","debug","locationSelect","document","getElementById","manualUpc","addItemBtn","sessionCount","sessionItems","printQrBtn","scannerContainer","scanner","sessionItemCount","sessionItemIds","initScanner","error","innerHTML","controlsDiv","createElement","className","appendChild","UniversalScanner","containerId","resultCallback","handleScanResult","errorCallback","handleScanError","init","then","success","showFallbackInterface","startBtn","stopBtn","scanBtn","flipBtn","manualInput","manualBtn","isScanning","scanTimeout","isMirrored","updateVideoMirror","videoElement","querySelector","style","transform","performSingleScan","Promise","resolve","scanAttempts","maxAttempts","found","scanFrame","async","video","readyState","HAVE_ENOUGH_DATA","requestAnimationFrame","context","drawImage","canvas","width","height","hasBarcodeDetector","detector","BarcodeDetector","formats","barcodes","detect","length","barcode","rawValue","format","processBarcode","imageData","getImageData","code","jsQR","scan","data","addEventListener","stream","getCameraStreamRobust","srcObject","play","videoWidth","videoHeight","updateStatus","disabled","display","updateProductDetailsPanel","compatibility","checkCameraCompatibility","supported","addNotification","message","type","showDetailedCompatibilityError","getTracks","forEach","track","stop","clearTimeout","icon","text","showSuccessMessage","showScanSuccess","showErrorMessage","setTimeout","value","trim","e","key","click","setupScannerControls","scannerControls","testButton","id","originalText","this","testUrl","M","cfg","wwwroot","response","fetch","method","headers","Accept","status","ok","Object","fromEntries","entries","testNetworkConnectivity","addNetworkTestButton","result","barcodeData","barcode_data","errorCode","isMobile","test","navigator","userAgent","isHTTP","window","location","protocol","content","origin","testBtn","testCameraAccess","fileUploadSection","fileInput","processFileBtn","files","file","reject","reader","FileReader","onload","img","Image","getContext","willReadFrequently","onerror","Error","src","target","readAsDataURL","processImageFile","setupFileUpload","errorMessage","name","issues","browserInfo","getBrowserInfo","apis","mediaDevices","getUserMedia","webkitGetUserMedia","mozGetUserMedia","hostname","push","mobile","ua","chrome","firefox","safari","edge","version","android","ios","match","parseInt","constraints","facingMode","ideal","keys","api","issue","locationId","originalBarcode","normalizedBarcode","upc","replace","padStart","charAt","substring","normalizeUPC","processingBtn","textContent","sesskey","requestUrl","requestData","locationid","url","currentOrigin","currentHost","host","body","JSON","stringify","statusText","contentType","get","includes","textResponse","json","itemid","updateSessionDisplay","product_name","product_url","stack","processUPC","finally","productName","alert","parentNode","remove","productUrl","alertType","productDetails","alertClass","destroy","params","URLSearchParams","action","itemids","join","open","toString"],"mappings":"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"}