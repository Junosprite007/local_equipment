{"version":3,"file":"editpartnership_form copy.min.js","sources":["../src/editpartnership_form copy.js"],"sourcesContent":["// This file is part of FLIP Plugins for Moodle\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <https://www.gnu.org/licenses/>.\n\n/**\n * JavaScript for handling partnership course list functionality\n *\n * @module     local_equipment/editpartnership_form\n * @copyright  2024 Josh Kirby <josh@funlearningcompany.com>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport Log from 'core/log';\nimport { get_string as getString } from 'core/str';\n\n/**\n * Initialize the module\n */\nexport const init = async () => {\n    // Core form elements\n    const $partnershipSelect = $('#id_partnershipcourselist');\n    const $coursesData = $('#id_coursesthisyear');\n    const coursesContainer = $('<div>').addClass(\n        'local-equipment_partnership-courses-container mt-3'\n    ); // Changed to mt-3 for spacing below dropdown\n\n    // Add courses container after the select element\n    $partnershipSelect.after(coursesContainer);\n\n    // Get strings\n    const strings = await Promise.all([\n        getString('errorparsingcoursesdata', 'local_equipment'),\n        getString('nocoursesfoundforthispartnership', 'local_equipment'),\n        getString('courseid', 'local_equipment'),\n        getString('coursename', 'local_equipment'),\n        getString('totalcourses', 'local_equipment'),\n    ]);\n\n    const [\n        errorParsingData,\n        noCoursesFound,\n        courseIdLabel,\n        courseNameLabel,\n        totalCoursesLabel,\n    ] = strings;\n\n    // Parse the courses data\n    let coursesData;\n    try {\n        coursesData = JSON.parse($coursesData.attr('data-coursesthisyear'));\n    } catch (e) {\n        Log.error(errorParsingData, e);\n        return;\n    }\n\n    /**\n     * Display courses for selected partnership\n     * @param {string} partnershipId Selected partnership ID\n     */\n    const displayPartnershipCourses = (partnershipId) => {\n        // Clear current courses\n        coursesContainer.empty();\n\n        // Get courses for selected partnership\n        const partnershipCourses = coursesData[partnershipId];\n\n        if (\n            !partnershipCourses ||\n            Object.keys(partnershipCourses).length === 0\n        ) {\n            coursesContainer.html(\n                `<div class=\"alert alert-warning\">${noCoursesFound}</div>`\n            );\n            // return;\n        }\n\n        // Create main container\n        const $mainContainer = $('<div>').addClass(\n            'local-equipment_main-courses-container'\n        );\n\n        // Create header\n        const $header = $('<div>')\n            .addClass('local-equipment_courses-header d-flex')\n            .append(\n                $('<div>')\n                    .addClass('local-equipment_course-id-col')\n                    .text(courseIdLabel),\n                $('<div>')\n                    .addClass('local-equipment_course-name-col')\n                    .text(courseNameLabel)\n            );\n\n        // Create scrollable content area\n        const $scrollContent = $('<div>').addClass(\n            'local-equipment_courses-scroll-content'\n        );\n\n        // Sort and add courses\n        const sortedCourseIds = Object.keys(partnershipCourses).sort(\n            (a, b) => parseInt(a) - parseInt(b)\n        );\n\n        sortedCourseIds.forEach((courseId) => {\n            $('<div>')\n                .addClass('local-equipment_course-row d-flex')\n                .append(\n                    $('<div>')\n                        .addClass('local-equipment_course-id-col')\n                        .text(courseId),\n                    $('<div>')\n                        .addClass('local-equipment_course-name-col')\n                        .text(partnershipCourses[courseId])\n                )\n                .appendTo($scrollContent);\n        });\n\n        // Create footer\n        const courseCount = sortedCourseIds.length;\n        const $footer = $('<div>')\n            .addClass('local-equipment_courses-footer')\n            .text(`${totalCoursesLabel}: ${courseCount}`);\n\n        // Assemble structure\n        $mainContainer.append($header).append($scrollContent).append($footer);\n\n        coursesContainer.append($mainContainer);\n    };\n\n    // Handle partnership selection change\n    $partnershipSelect.on('change', function () {\n        const selectedPartnership = $(this).val();\n        if (selectedPartnership) {\n            displayPartnershipCourses(selectedPartnership);\n        } else {\n            coursesContainer.empty();\n        }\n    });\n\n    // Display initial courses if partnership is pre-selected\n    const initialPartnership = $partnershipSelect.val();\n    if (initialPartnership) {\n        displayPartnershipCourses(initialPartnership);\n    }\n};\n"],"names":["async","$partnershipSelect","$coursesData","coursesContainer","addClass","after","strings","Promise","all","errorParsingData","noCoursesFound","courseIdLabel","courseNameLabel","totalCoursesLabel","coursesData","JSON","parse","attr","e","error","displayPartnershipCourses","partnershipId","empty","partnershipCourses","Object","keys","length","html","$mainContainer","$header","append","text","$scrollContent","sortedCourseIds","sort","a","b","parseInt","forEach","courseId","appendTo","courseCount","$footer","on","selectedPartnership","this","val","initialPartnership"],"mappings":";;;;;;;0KA8BoBA,gBAEVC,oBAAqB,mBAAE,6BACvBC,cAAe,mBAAE,uBACjBC,kBAAmB,mBAAE,SAASC,SAChC,sDAIJH,mBAAmBI,MAAMF,wBAGnBG,cAAgBC,QAAQC,IAAI,EAC9B,mBAAU,0BAA2B,oBACrC,mBAAU,mCAAoC,oBAC9C,mBAAU,WAAY,oBACtB,mBAAU,aAAc,oBACxB,mBAAU,eAAgB,sBAI1BC,iBACAC,eACAC,cACAC,gBACAC,mBACAP,YAGAQ,gBAEAA,YAAcC,KAAKC,MAAMd,aAAae,KAAK,yBAC7C,MAAOC,4BACDC,MAAMV,iBAAkBS,SAQ1BE,0BAA6BC,gBAE/BlB,iBAAiBmB,cAGXC,mBAAqBT,YAAYO,eAGlCE,oBAC0C,IAA3CC,OAAOC,KAAKF,oBAAoBG,QAEhCvB,iBAAiBwB,gDACuBjB,gCAMtCkB,gBAAiB,mBAAE,SAASxB,SAC9B,0CAIEyB,SAAU,mBAAE,SACbzB,SAAS,yCACT0B,QACG,mBAAE,SACG1B,SAAS,iCACT2B,KAAKpB,gBACV,mBAAE,SACGP,SAAS,mCACT2B,KAAKnB,kBAIZoB,gBAAiB,mBAAE,SAAS5B,SAC9B,0CAIE6B,gBAAkBT,OAAOC,KAAKF,oBAAoBW,MACpD,CAACC,EAAGC,IAAMC,SAASF,GAAKE,SAASD,KAGrCH,gBAAgBK,SAASC,+BACnB,SACGnC,SAAS,qCACT0B,QACG,mBAAE,SACG1B,SAAS,iCACT2B,KAAKQ,WACV,mBAAE,SACGnC,SAAS,mCACT2B,KAAKR,mBAAmBgB,YAEhCC,SAASR,yBAIZS,YAAcR,gBAAgBP,OAC9BgB,SAAU,mBAAE,SACbtC,SAAS,kCACT2B,eAAQlB,+BAAsB4B,cAGnCb,eAAeE,OAAOD,SAASC,OAAOE,gBAAgBF,OAAOY,SAE7DvC,iBAAiB2B,OAAOF,iBAI5B3B,mBAAmB0C,GAAG,UAAU,iBACtBC,qBAAsB,mBAAEC,MAAMC,MAChCF,oBACAxB,0BAA0BwB,qBAE1BzC,iBAAiBmB,iBAKnByB,mBAAqB9C,mBAAmB6C,MAC1CC,oBACA3B,0BAA0B2B"}