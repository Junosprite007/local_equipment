define("local_equipment/vccsubmission_addstudents_form",["exports","jquery","core/str","core/log"],(function(_exports,_jquery,_str,_log){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * JavaScript for the add students form.
   *
   * @module     local_equipment/vccsubmission_addstudents_form
   * @copyright  2024 Joshua Kirby <josh@funlearningcompany.com>
   * @license    https://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.init=void 0,_jquery=_interopRequireDefault(_jquery),_log=_interopRequireDefault(_log);_exports.init=()=>{_log.default.debug("Add Student Form JS initialized"),setupStudentsHandling()};const setupStudentsHandling=()=>{(0,_jquery.default)(document).on("click",".local-equipment-remove-student",(function(){(0,_jquery.default)(this).closest("fieldset[id^='id_studentheader_']").remove(),updateStudentNumbers(),updateHiddenFields(),renumberFormElements(),updateTrashIcons()})),updateTrashIcons()},updateStudentNumbers=()=>{(0,_jquery.default)(".local-equipment-student-header").each(((index,element)=>{(0,_str.get_string)("student","local_equipment",index+1).then((string=>{(0,_jquery.default)(element).text(string)})).catch((error=>{_log.default.error("Error updating student header:",error)}))}))},updateHiddenFields=()=>{const studentsCount=(0,_jquery.default)("fieldset[id^='id_studentheader_']").length;(0,_jquery.default)('input[name="students"]').val(studentsCount);const url=new URL(window.location.href);url.searchParams.set("repeatno",studentsCount),window.history.replaceState({},"",url)},renumberFormElements=()=>{(0,_jquery.default)("fieldset[id^='id_studentheader_']").each(((index,fieldset)=>{(0,_jquery.default)(fieldset).find("input, select, textarea").each(((_,element)=>{const name=(0,_jquery.default)(element).attr("name");if(name){const newName=name.replace(/\[\d+\]/,"[".concat(index,"]"));(0,_jquery.default)(element).attr("name",newName)}const id=(0,_jquery.default)(element).attr("id");if(id){const newId=id.replace(/_\d+_/,"_".concat(index,"_"));(0,_jquery.default)(element).attr("id",newId)}}))}))},updateTrashIcons=()=>{(0,_jquery.default)("fieldset[id^='id_studentheader_']").length>1?(0,_jquery.default)(".local-equipment-remove-student").show():(0,_jquery.default)(".local-equipment-remove-student").hide()}}));

//# sourceMappingURL=vccsubmission_addstudents_form.min.js.map