{{!
    @template local_equipment/vcc_pagination_ajax

    VCC submissions AJAX pagination template.

    This template is used for AJAX pagination content updates without full page reload.
    Contains the table data and pagination controls that get replaced via AJAX.

    Context variables:
    * table_rows - Array of table row data objects
    * pagination - Pagination object with controls and information
    * total_count - Total number of records
    * page_size - Number of records per page
    * current_page - Current page number
    * has_data - Boolean indicating if there are results to show
    * filters_applied - Boolean indicating if filters are active
    * sort_column - Currently sorted column
    * sort_direction - Current sort direction (asc/desc)
    * ajax_url - Base URL for AJAX requests
    * sesskey - Moodle session key for security
    * export_urls - URLs for data export (CSV, Excel)
}}

{{#has_data}}
<div class="table-responsive vcc-submissions-table" data-region="table-container">
    <table class="table table-striped table-hover" id="vcc-submissions-table">
        <thead class="table-light">
            <tr>
                {{#table_headers}}
                <th scope="col"
                    class="{{#sortable}}sortable{{/sortable}}{{#current_sort}} sorted-{{direction}}{{/current_sort}}"
                    {{#sortable}}data-sort="{{column}}" role="button" tabindex="0"{{/sortable}}
                    {{#width}}data-width="{{width}}"{{/width}}>
                    <div class="d-flex align-items-center justify-content-between">
                        <span>{{name}}</span>
                        {{#sortable}}
                        <div class="sort-indicators ms-2">
                            <i class="fa fa-sort{{#current_sort}}-{{direction}}{{/current_sort}}
                               {{^current_sort}}text-muted{{/current_sort}}"
                               aria-hidden="true"></i>
                        </div>
                        {{/sortable}}
                    </div>
                </th>
                {{/table_headers}}
            </tr>
        </thead>
        <tbody>
            {{#table_rows}}
            <tr data-submission-id="{{id}}" class="vcc-submission-row">
                {{#cells}}
                <td class="{{css_class}}" {{#data_attributes}}{{{.}}}{{/data_attributes}}>
                    {{{content}}}
                </td>
                {{/cells}}
            </tr>
            {{/table_rows}}
            {{^table_rows}}
            <tr>
                <td colspan="{{table_columns_count}}" class="text-center text-muted py-4">
                    {{#str}}nosubmissionsfound, local_equipment{{/str}}
                </td>
            </tr>
            {{/table_rows}}
        </tbody>
    </table>
</div>

{{! Pagination Controls }}
<div class="vcc-pagination-wrapper d-flex flex-column flex-md-row justify-content-between align-items-center mt-3"
     data-region="pagination-container">

    {{! Results Summary }}
    <div class="pagination-info mb-2 mb-md-0">
        <small class="text-muted">
            {{#str}}showingrecords, local_equipment, {
                "start": {{pagination.start_record}},
                "end": {{pagination.end_record}},
                "total": {{total_count}}
            }{{/str}}
            {{#filters_applied}}
            <span class="badge text-bg-info ms-1">
                <i class="fa fa-filter" aria-hidden="true"></i>
                {{#str}}filtered, local_equipment{{/str}}
            </span>
            {{/filters_applied}}
        </small>
    </div>

    {{! Pagination Navigation }}
    {{#pagination.show_pagination}}
    <nav aria-label="{{#str}}pagination, local_equipment{{/str}}" class="vcc-pagination">
        <ul class="pagination pagination-sm mb-0">
            {{! First Page }}
            {{#pagination.show_first}}
            <li class="page-item">
                <a class="page-link ajax-page-link"
                   href="#"
                   data-page="1"
                   aria-label="{{#str}}first, local_equipment{{/str}}">
                    <i class="fa fa-angle-double-left" aria-hidden="true"></i>
                    <span class="visually-hidden">{{#str}}first, local_equipment{{/str}}</span>
                </a>
            </li>
            {{/pagination.show_first}}

            {{! Previous Page }}
            {{#pagination.show_previous}}
            <li class="page-item">
                <a class="page-link ajax-page-link"
                   href="#"
                   data-page="{{pagination.previous_page}}"
                   aria-label="{{#str}}previous, local_equipment{{/str}}">
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="visually-hidden">{{#str}}previous, local_equipment{{/str}}</span>
                </a>
            </li>
            {{/pagination.show_previous}}
            {{^pagination.show_previous}}
            <li class="page-item disabled">
                <span class="page-link">
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="visually-hidden">{{#str}}previous, local_equipment{{/str}}</span>
                </span>
            </li>
            {{/pagination.show_previous}}

            {{! Page Numbers }}
            {{#pagination.pages}}
            <li class="page-item {{#current}}active{{/current}}">
                {{#current}}
                <span class="page-link" aria-current="page">
                    {{page}}
                    <span class="visually-hidden">({{#str}}current, local_equipment{{/str}})</span>
                </span>
                {{/current}}
                {{^current}}
                <a class="page-link ajax-page-link"
                   href="#"
                   data-page="{{page}}"
                   aria-label="{{#str}}page, local_equipment, {{page}}{{/str}}">
                    {{page}}
                </a>
                {{/current}}
            </li>
            {{/pagination.pages}}

            {{! Next Page }}
            {{#pagination.show_next}}
            <li class="page-item">
                <a class="page-link ajax-page-link"
                   href="#"
                   data-page="{{pagination.next_page}}"
                   aria-label="{{#str}}next, local_equipment{{/str}}">
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                    <span class="visually-hidden">{{#str}}next, local_equipment{{/str}}</span>
                </a>
            </li>
            {{/pagination.show_next}}
            {{^pagination.show_next}}
            <li class="page-item disabled">
                <span class="page-link">
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                    <span class="visually-hidden">{{#str}}next, local_equipment{{/str}}</span>
                </span>
            </li>
            {{/pagination.show_next}}

            {{! Last Page }}
            {{#pagination.show_last}}
            <li class="page-item">
                <a class="page-link ajax-page-link"
                   href="#"
                   data-page="{{pagination.total_pages}}"
                   aria-label="{{#str}}last, local_equipment{{/str}}">
                    <i class="fa fa-angle-double-right" aria-hidden="true"></i>
                    <span class="visually-hidden">{{#str}}last, local_equipment{{/str}}</span>
                </a>
            </li>
            {{/pagination.show_last}}
        </ul>
    </nav>
    {{/pagination.show_pagination}}

    {{! Per Page Selector }}
    <div class="pagination-size-selector d-flex align-items-center">
        <label for="page-size-select" class="form-label mb-0 me-2 small">
            {{#str}}recordsperpage, local_equipment{{/str}}:
        </label>
        <select id="page-size-select"
                class="form-select form-select-sm ajax-page-size-select vcc-pagination-width-auto">
            {{#page_size_options}}
            <option value="{{value}}" {{#selected}}selected{{/selected}}>
                {{label}}
            </option>
            {{/page_size_options}}
        </select>
    </div>
</div>

{{! Export Controls }}
{{#export_urls}}
<div class="vcc-export-controls mt-3 d-flex justify-content-end">
    <div class="btn-group" role="group" aria-label="{{#str}}exportdata, local_equipment{{/str}}">
        <a href="{{csv_url}}" class="btn btn-outline-secondary btn-sm">
            <i class="fa fa-download me-1" aria-hidden="true"></i>
            {{#str}}exportcsv, local_equipment{{/str}}
        </a>
        <a href="{{excel_url}}" class="btn btn-outline-secondary btn-sm">
            <i class="fa fa-file-excel-o me-1" aria-hidden="true"></i>
            {{#str}}exportexcel, local_equipment{{/str}}
        </a>
    </div>
</div>
{{/export_urls}}

{{/has_data}}

{{^has_data}}
{{> local_equipment/vcc_empty_state }}
{{/has_data}}

{{! Loading overlay for AJAX requests }}
<div class="vcc-loading-overlay position-absolute top-0 start-0 w-100 h-100
     d-flex align-items-center justify-content-center bg-white bg-opacity-75 vcc-loading-hidden"
     data-region="loading-overlay">
    <div class="text-center">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">{{#str}}loading, local_equipment{{/str}}</span>
        </div>
        <div class="mt-2 text-muted small">{{#str}}loading, local_equipment{{/str}}...</div>
    </div>
</div>

{{! JavaScript data for AJAX operations }}
<script type="application/json" id="vcc-pagination-data">
{
    "currentPage": {{current_page}},
    "pageSize": {{page_size}},
    "totalCount": {{total_count}},
    "totalPages": {{pagination.total_pages}},
    "sortColumn": "{{sort_column}}",
    "sortDirection": "{{sort_direction}}",
    "filtersApplied": {{filters_applied}},
    "ajaxUrl": "{{ajax_url}}",
    "sesskey": "{{sesskey}}",
    "hasData": {{has_data}}
}
</script>

{{! Screen reader announcements for dynamic content }}
<div class="visually-hidden" aria-live="polite" id="pagination-status-announcer">
    {{#str}}showingrecords, local_equipment, {
        "start": {{pagination.start_record}},
        "end": {{pagination.end_record}},
        "total": {{total_count}}
    }{{/str}}
</div>
